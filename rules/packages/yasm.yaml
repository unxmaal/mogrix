# yasm - modular assembler (x86/x86-64, C code)
# Host code generators (genperf, genmacro, genversion, genmodule, genstring, re2c)
# use CC_FOR_BUILD/CCLD_FOR_BUILD but Makefile.in appends $(LIBS) which leaks
# the cross-compiled -lmogrix-compat archive into host linking.
package: yasm

rules:
  drop_buildrequires:
    - xmlto
    - byacc
  prep_commands:
    # Remove $(LIBS) from host tool link lines â€” LIBS contains
    # -lmogrix-compat (MIPS cross-compiled), which can't link with host cc.
    - "$MOGRIX_ROOT/tools/safepatch Makefile.in --old '$(genmacro_LDADD) $(LIBS)' --new '$(genmacro_LDADD)' --no-backup --quiet"
    - "$MOGRIX_ROOT/tools/safepatch Makefile.in --old '$(genmodule_LDADD) $(LIBS)' --new '$(genmodule_LDADD)' --no-backup --quiet"
    - "$MOGRIX_ROOT/tools/safepatch Makefile.in --old '$(genperf_LDADD) $(LIBS)' --new '$(genperf_LDADD)' --no-backup --quiet"
    - "$MOGRIX_ROOT/tools/safepatch Makefile.in --old '$(genstring_LDADD) $(LIBS)' --new '$(genstring_LDADD)' --no-backup --quiet"
    - "$MOGRIX_ROOT/tools/safepatch Makefile.in --old '$(genversion_LDADD) $(LIBS)' --new '$(genversion_LDADD)' --no-backup --quiet"
    - "$MOGRIX_ROOT/tools/safepatch Makefile.in --old '$(re2c_LDADD) $(LIBS)' --new '$(re2c_LDADD)' --no-backup --quiet"
