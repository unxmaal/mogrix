package: file
rules:
  ac_cv_overrides:
    ac_cv_func_getopt_long: 'yes'
  export_vars:
    LDFLAGS: -L/opt/sgug-staging/usr/sgug/lib32
  configure_flags:
    add:
    - --enable-fsect-man5
    - --enable-shared
  spec_replacements:
  - pattern: '%bcond_without python2'
    replacement: '%bcond_with python2'
  - pattern: '%bcond_without python3'
    replacement: '%bcond_with python3'
  - pattern: '# remove hardcoded library paths from local libtool'
    replacement: '# Fix libtool for IRIX using generic script (note: file uses custom soname)

      $MOGRIX_ROOT/tools/fix-libtool-irix.sh libtool || exit 1

      # file-specific: Custom SONAME for libmagic (libmagic.so.1)

      sed -i ''s|^soname_spec=.*|soname_spec="\\$libname\\$release\\$shared_ext.\\$major"|g'' libtool

      sed -i ''s|^library_names_spec=.*|library_names_spec="\\$libname\\$release\\$shared_ext.\\$versuffix \\$libname\\$release\\$shared_ext.\\$major \\$libname\\$shared_ext"|g'' libtool

      # Add mogrix-compat library to src/Makefile LIBS

      sed -i "s|^LIBS = |LIBS = -L$(pwd)/mogrix-compat -lmogrix-compat |g" src/Makefile

      # remove hardcoded library paths from local libtool

      '
  - pattern: '%{_libdir}/*so.*'
    replacement: '%{_libdir}/*.so*'
