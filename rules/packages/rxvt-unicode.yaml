package: rxvt-unicode
rules:
  inject_compat_functions:
  - unsetenv
  drop_buildrequires:
  - gdk-pixbuf2-devel
  - libptytty-devel
  - libX11-devel
  - libXext-devel
  - libXt-devel
  - signify
  - startup-notification-devel
  - xorg-x11-proto-devel
  drop_requires:
  - startup-notification
  prep_commands:
  - "for f in $(find src -name '*.C' -o -name '*.h'); do $MOGRIX_ROOT/tools/safepatch \"$f\" --old 'XICCallback' --new 'XIMCallback' --count 0 --no-backup --quiet || :; done"
  - "for f in $(find src -name '*.C' -o -name '*.h'); do $MOGRIX_ROOT/tools/safepatch \"$f\" --old 'Xutf8TextListToTextProperty' --new 'XmbTextListToTextProperty' --count 0 --no-backup --quiet || :; done"
  - "for f in $(find src -name '*.C' -o -name '*.h'); do $MOGRIX_ROOT/tools/safepatch \"$f\" --old 'XUTF8StringStyle' --new 'XCompoundTextStyle' --count 0 --no-backup --quiet || :; done"
  - '$MOGRIX_ROOT/tools/safepatch src/rxvt.h --insert-top ''#define XSetIMValues(...) 0  /* IRIX X11R6.3: not available */'' --no-backup --quiet'
  - "for f in configure configure.ac; do $MOGRIX_ROOT/tools/safepatch $f --old '-D_XOPEN_SOURCE[^ ]*' --new '' --regex --count 0 --no-backup --quiet || :; done"
  configure_flags:
    add:
    - --disable-pixbuf
  spec_replacements:
  - pattern: '%{gpgverify} --keyring=''%{SOURCE4}'' --signature=''%{SOURCE3}'' --data=''%{SOURCE2}''

      signify -V -p ''%{SOURCE2}'' -m ''%{SOURCE0}''

      %autosetup -S git'
    replacement: '%setup -q'
  - pattern: 'BuildRequires:  perl-devel, perl-generators, perl(ExtUtils::Embed)

      '
    replacement: ''
  - pattern: " --enable-utmp \\\n --enable-wtmp \\\n --enable-lastlog \\\n"
    replacement: " --disable-utmp \\\n --disable-wtmp \\\n --disable-lastlog \\\n"
  - pattern: ' --enable-perl \

      '
    replacement: ' --disable-perl \

      '
  - pattern: ' --enable-startup-notification \

      '
    replacement: ' --disable-startup-notification \

      '
  - pattern: '# This isn''t something we need

      rm %{buildroot}%{_bindir}/urclock

      rm %{buildroot}%{_mandir}/man1/urclock.1*'
    replacement: '# urclock cleanup (perl script, not useful on IRIX)

      rm -f %{buildroot}%{_bindir}/urclock

      rm -f %{buildroot}%{_mandir}/man1/urclock.1*'
  - pattern: "# install desktop files\ndesktop-file-install \\\n%if (0%{?fedora} && 0%{?fedora} < 19) || (0%{?rhel} && 0%{?rhel} < 7)\n  --vendor=fedora \\\n%endif\n  --dir=%{buildroot}%{_datadir}/applications\
      \ \\\n  %{SOURCE5}"
    replacement: '# desktop file install skipped for IRIX'
  - pattern: '# create compat symlinks

      pushd $RPM_BUILD_ROOT/%{_bindir}

      ln -s urxvt rxvt

      ln -s urxvt urxvt-ml

      ln -s urxvtc urxvt-mlc

      ln -s urxvtd urxvt-mld

      ln -s urxvt urxvt256c

      ln -s urxvtc urxvt256cc

      ln -s urxvtd urxvt256cd

      ln -s urxvt urxvt256c-ml

      ln -s urxvtc urxvt256c-mlc

      ln -s urxvtd urxvt256c-mld

      popd'
    replacement: '# compat symlinks skipped for IRIX'
  - pattern: '%{_bindir}/rxvt

      '
    replacement: ''
  - pattern: '%{_bindir}/urxvt-ml

      %{_bindir}/urxvt-mlc

      %{_bindir}/urxvt-mld

      '
    replacement: ''
  - pattern: '%{_bindir}/urxvt256c

      %{_bindir}/urxvt256cc

      %{_bindir}/urxvt256cd

      '
    replacement: ''
  - pattern: '%{_bindir}/urxvt256c-ml

      %{_bindir}/urxvt256c-mlc

      %{_bindir}/urxvt256c-mld

      '
    replacement: ''
  - pattern: '%{_mandir}/man1/urxvt-background.1*

      %{_mandir}/man1/urxvt-bell-command.1*

      %{_mandir}/man1/urxvt-block-graphics-to-ascii.1*

      %{_mandir}/man1/urxvt-clipboard-osc.1*

      %{_mandir}/man1/urxvt-clickthrough.1*

      %{_mandir}/man1/urxvt-confirm-paste.1*

      %{_mandir}/man1/urxvt-digital-clock.1*

      %{_mandir}/man1/urxvt-eval.1*

      %{_mandir}/man1/urxvt-example-refresh-hooks.1*

      %{_mandir}/man1/urxvt-extensions.1*

      %{_mandir}/man1/urxvt-keysym-list.1*

      %{_mandir}/man1/urxvt-kuake.1*

      %{_mandir}/man1/urxvt-matcher.1*

      %{_mandir}/man1/urxvt-option-popup.1*

      %{_mandir}/man1/urxvt-overlay-osc.1*

      %{_mandir}/man1/urxvt-readline.1*

      %{_mandir}/man1/urxvt-remote-clipboard.1*

      %{_mandir}/man1/urxvt-searchable-scrollback.1*

      %{_mandir}/man1/urxvt-selection-autotransform.1*

      %{_mandir}/man1/urxvt-selection-pastebin.1*

      %{_mandir}/man1/urxvt-selection-popup.1*

      %{_mandir}/man1/urxvt-selection-to-clipboard.1*

      %{_mandir}/man1/urxvt-selection.1*

      %{_mandir}/man1/urxvt-tabbed.1*

      %{_mandir}/man1/urxvt-xim-onthespot.1*

      %{_mandir}/man3/urxvtperl.3*

      '
    replacement: ''
  - pattern: '%{_datadir}/applications/*rxvt-unicode.desktop

      %{_libdir}/urxvt

      '
    replacement: ''
  install_cleanup:
  - rm -f %{buildroot}%{_datadir}/applications/*rxvt-unicode.desktop
