# Mogrix Compat Source Catalog
# Maps function names to their source files
#
# ---index---
# Categories and key functions for quick reference:
#
# string/     : strdup, strndup, strcasestr, strsep
# stdio/      : getline, asprintf, funopen (BSD cookie I/O - USE THIS, not fopencookie)
# stdlib/     : reallocarray, secure_getenv, mkdtemp, qsort_r
# runtime/    : stpcpy, spawn (posix_spawn/posix_spawnp/file_actions)
# dicl/       : openat-compat.c (17 POSIX "at" functions: openat, fstatat, futimens, etc.)
# functions/  : getopt_long
# unistd/     : getprogname, setprogname
# time/       : timegm
# error/      : strerror_r
#
# IMPORTANT: fopencookie (stdio/fopencookie.c) CRASHES on IRIX - use funopen instead
# IMPORTANT: vasprintf in asprintf.c uses iterative approach (IRIX vsnprintf(NULL,0) returns -1)
# ---

functions:
  # String functions
  strdup:
    file: string/strdup.c
    header: string.h
    description: Duplicate a string

  strndup:
    file: string/strndup.c
    header: string.h
    description: Duplicate at most n bytes of a string

  strcasestr:
    file: string/strcasestr.c
    header: string.h
    description: Case-insensitive substring search (GNU extension)

  strsep:
    file: string/strsep.c
    header: string.h
    description: Extract token from string (BSD extension)

  stpcpy:
    file: runtime/stpcpy.c
    header: string.h
    description: Copy string and return pointer to end (POSIX.1-2008)

  # stdio functions
  getline:
    file: stdio/getline.c
    header: stdio.h
    description: Read a line from stream
    provides:
      - getline
      - getdelim

  getdelim:
    file: stdio/getline.c
    header: stdio.h
    description: Read delimited input from stream

  asprintf:
    file: stdio/asprintf.c
    header: stdio.h
    description: Print to allocated string
    provides:
      - asprintf
      - vasprintf

  vasprintf:
    file: stdio/asprintf.c
    header: stdio.h
    description: Print to allocated string (va_list version)

  fopencookie:
    file: stdio/fopencookie.c
    header: stdio/fopencookie.h
    description: Custom stream I/O (glibc extension for libsolv)
    requires_pthread: true
    notes: Portable implementation based on musl community code - CRASHES ON IRIX, use funopen instead

  funopen:
    file: stdio/funopen.c
    header: stdio.h
    description: Custom stream I/O (BSD extension for libsolv)
    requires_pthread: true
    notes: BSD-style cookie I/O, more reliable on IRIX than fopencookie

  # setenv/unsetenv (IRIX only has putenv)
  setenv:
    file: stdlib/setenv.c
    header: stdlib.h
    description: Set environment variable (POSIX)
    provides:
      - setenv
      - unsetenv

  unsetenv:
    file: stdlib/setenv.c
    header: stdlib.h
    description: Remove environment variable (POSIX)

  # stdlib functions
  strtof:
    file: strtof.c
    header: stdlib.h
    description: Convert string to float (IRIX libc lacks this)

  reallocarray:
    file: stdlib/reallocarray.c
    header: stdlib.h
    description: Safe array reallocation with overflow check

  secure_getenv:
    file: stdlib/secure_getenv.c
    header: stdlib.h
    description: Secure environment variable access (GNU extension)

  mkdtemp:
    file: stdlib/mkdtemp.c
    header: stdlib.h
    description: Create a unique temporary directory (BSD/POSIX)

  qsort_r:
    file: stdlib/qsort_r.c
    header: stdlib.h
    description: qsort with user data pointer (GNU extension)
    notes: Not thread-safe - uses global state for emulation

  # time functions
  timegm:
    file: time/timegm.c
    header: time.h
    description: Convert broken-down time to time_t in UTC (GNU extension)

  # error functions
  strerror_r:
    file: error/strerror_r.c
    header: string.h
    description: Thread-safe strerror

  # getopt_long (GNU extension for long options)
  getopt_long:
    file: functions/getopt_long.c
    header: getopt.h
    description: Parse long options (GNU extension)
    provides:
      - getopt_long
      - getopt_long_only

  # Program name functions (BSD/GNU extension)
  getprogname:
    file: unistd/getprogname.c
    header: stdlib.h
    description: Get program name (BSD extension)
    provides:
      - getprogname
      - setprogname

  setprogname:
    file: unistd/getprogname.c
    header: stdlib.h
    description: Set program name (BSD extension)

  # POSIX spawn functions (IRIX lacks these)
  posix_spawn:
    file: runtime/spawn.c
    header: spawn.h
    description: Spawn a new process
    provides:
      - posix_spawn
      - posix_spawnp

  posix_spawnp:
    file: runtime/spawn.c
    header: spawn.h
    description: Spawn a new process, searching PATH

  # rld interface stubs
  _rld_new_interface:
    file: rld/rld_new_interface.c
    header: rld_interface.h
    description: IRIX rld interface stub for cross-compilation

  # SQLite3 stub for packages that optionally use sqlite3 (e.g., tdnf history)
  sqlite3_stub:
    file: sqlite/sqlite3_stub.c
    header: sqlite3.h
    description: Stub sqlite3 implementation for IRIX (history features disabled)
    notes: All functions return error codes - history functionality will not work

  # POSIX.1-2008 "at" functions (IRIX lacks these)
  openat:
    file: dicl/openat-compat.c
    header: fcntl.h
    description: Open file relative to directory file descriptor
    provides:
      - openat
      - fstatat
      - faccessat
      - mkdirat
      - unlinkat
      - renameat
      - readlinkat
      - symlinkat
      - linkat
      - fchmodat
      - fchownat
      - mkfifoat
      - mknodat
      - utimensat
      - futimens
      - stpcpy
      - stpncpy

  fstatat:
    file: dicl/openat-compat.c
    header: sys/stat.h
    description: Get file status relative to directory fd

  faccessat:
    file: dicl/openat-compat.c
    header: unistd.h
    description: Check permissions relative to directory fd

  mkdirat:
    file: dicl/openat-compat.c
    header: sys/stat.h
    description: Create directory relative to directory fd

  unlinkat:
    file: dicl/openat-compat.c
    header: unistd.h
    description: Remove file/directory relative to directory fd

  renameat:
    file: dicl/openat-compat.c
    header: stdio.h
    description: Rename file relative to directory fds

  readlinkat:
    file: dicl/openat-compat.c
    header: unistd.h
    description: Read symbolic link relative to directory fd

  symlinkat:
    file: dicl/openat-compat.c
    header: unistd.h
    description: Create symbolic link relative to directory fd

  linkat:
    file: dicl/openat-compat.c
    header: unistd.h
    description: Create hard link relative to directory fds

  fchmodat:
    file: dicl/openat-compat.c
    header: sys/stat.h
    description: Change file mode relative to directory fd

  fchownat:
    file: dicl/openat-compat.c
    header: unistd.h
    description: Change file owner relative to directory fd

# Common function sets for package classes
sets:
  # Basic string functions most packages need
  basic_string:
    - strdup
    - strndup

  # GNU extensions commonly used
  gnu_extensions:
    - strdup
    - strndup
    - getline
    - asprintf

  # POSIX.1-2008 "at" functions for packages requiring directory-relative ops
  posix_at:
    - openat
    - fstatat
    - faccessat
    - mkdirat
    - unlinkat
    - renameat
    - readlinkat
    - symlinkat
    - linkat
    - fchmodat
    - fchownat

  # Full compat set (replaces libdicl)
  full:
    - strdup
    - strndup
    - getline
    - asprintf
    - reallocarray
    - strerror_r
