package: sox
rules:
  drop_buildrequires:
  - pulseaudio-libs-devel
  - gsm-devel
  - wavpack-devel
  - ladspa-devel
  - libid3tag-devel
  - opusfile-devel
  - libmad-devel
  - twolame-devel
  - libsamplerate-devel
  export_vars:
    LD: /opt/cross/bin/mips-sgi-irix6.5-ld.bfd
  spec_replacements:
  - pattern: "%configure --without-lpc10 \\\n           --with-gsm \\\n           --includedir=%{_includedir}/sox \\\n           --disable-static \\\n           --with-distro=Fedora \\\n           --with-dyn-default\n"
    replacement: "%configure --without-lpc10 \\\n           --without-gsm \\\n           --without-ladspa \\\n           --without-mad \\\n           --without-id3tag \\\n           --without-twolame \\\
      \n           --without-wavpack \\\n           --without-opusfile \\\n           --without-samplerate \\\n           --without-png \\\n           --with-alsa=no \\\n           --with-pulseaudio=no\
      \ \\\n           --with-oss=no \\\n           --with-ao \\\n           --includedir=%{_includedir}/sox \\\n           --disable-static \\\n           --with-distro=IRIX\n$MOGRIX_ROOT/tools/fix-libtool-irix.sh\
      \ libtool || exit 1\n"
  - pattern: '%dir %{_libdir}/sox/

      %{_libdir}/sox/libsox_fmt_*.so

      '
    replacement: '# Dynamic plugins disabled for IRIX — formats linked statically into libsox

      '
  - pattern: 'rm -f $RPM_BUILD_ROOT%{_libdir}/sox/*.la

      rm -f $RPM_BUILD_ROOT%{_libdir}/sox/*.a

      '
    replacement: '# sox plugins disabled — no .la/.a to remove

      '
  - pattern: 'Requires: pkgconfig'
    replacement: 'Requires: pkgconfig

      Provides: libsox.so.3

      '
  - pattern: '%{_libdir}/libsox.so.*'
    replacement: '%{_libdir}/libsox.so.3

      %{_libdir}/libsox.so.3.*

      '
smoke_test:
- command: /usr/sgug/bin/sox --version 2>&1 | head -1
  expect: sox
