package: tinc
add_source:
- irix-device.c
upstream:
  url: https://www.tinc-vpn.org/packages/tinc-1.0.36.tar.gz
  version: 1.0.36
  type: tarball
  build_system: autoconf
  license: GPLv2+
  summary: Virtual Private Network daemon
  source_dir: tinc-1.0.36
rules:
  explicit_provides:
  - tinc
  ac_cv_overrides:
    ac_cv_func_pselect: 'no'
  export_vars:
    CFLAGS: -Wno-deprecated-declarations
  configure_flags:
    add:
    - --disable-uml
    - --disable-lzo
    - --disable-hardening
    - --with-openssl=yes
    - --with-openssl-include=/opt/sgug-staging/usr/sgug/include
    - --with-openssl-lib=/opt/sgug-staging/usr/sgug/lib32
  prep_commands:
  - sed -i '/^  \*)/i \  *irix*)\n  ;;' configure.ac
  - mkdir -p src/irix
  - cp %{_sourcedir}/irix-device.c src/irix/device.c
  - sed -i '/^if SOLARIS/,/^endif/a \\nif IRIX\ntincd_SOURCES += irix/device.c\nendif' src/Makefile.am
  - "$MOGRIX_ROOT/tools/safepatch configure.ac --old 'AM_CONDITIONAL(SOLARIS' --insert-after 'AM_CONDITIONAL(IRIX, test \"$irix\" = true)' --no-backup --quiet"
  - "$MOGRIX_ROOT/tools/safepatch configure.ac --old '  *irix*)' --new \"$(printf '  *irix*)\\n    irix=true')\" --no-backup --quiet"
