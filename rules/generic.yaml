# generic.yaml - Universal rules applied to ALL packages
#
# ---metadata---
# scope: global (applies to every package)
# purpose: Remove Linux-specific deps, set IRIX paths, skip %check
# key_sections:
#   - drop_buildrequires: systemd, selinux, kernel-headers, libdicl, etc.
#   - drop_requires: libdicl (replaced by mogrix compat injection)
#   - remove_lines: gpgverify, ldconfig_scriptlets, systemd scriptlets
#   - rpm_macros: _prefix=/usr/sgug, _libdir=/usr/sgug/lib32
#   - configure_disable: selinux, systemd, udev, inotify, epoll, etc.
#   - header_overlays: generic (stdarg.h, stdio.h, etc.)
#   - skip_check: true (can't run cross-compiled tests)
# ---

generic:
  drop_buildrequires:
    - systemd
    - systemd-devel
    - libselinux
    - libselinux-devel
    - kernel-headers
    - alsa-lib-devel
    - systemtap-sdt-devel
    - libcap-devel
    - libcap-ng-devel
    - libacl-devel
    - libattr-devel
    - audit-libs-devel
    # GPG verification not needed for cross-compilation
    - gnupg2
    # libdicl replaced by mogrix compat injection
    - libdicl
    - libdicl-devel

  drop_requires:
    - libdicl
    - libdicl-devel

  # Remove gpgverify calls - source verification not needed for cross-compilation
  # Many Fedora packages use %{gpgverify} in %prep to verify source signatures
  remove_lines:
    - "%{gpgverify}"
    # ldconfig scriptlets don't work for cross-compilation
    - "%ldconfig_scriptlets"
    # libdicl setup lines - mogrix injects compat functions directly
    - 'export CPPFLAGS="-I%{_includedir}/libdicl-0.1"'
    - 'export LIBS="-ldicl-0.1"'
    # systemd scriptlets - IRIX has no systemd
    - "%systemd_post"
    - "%systemd_preun"
    - "%systemd_postun"
    - "%systemd_postun_with_restart"
    - "%systemd_user_post"
    - "%systemd_user_preun"
    - "%systemd_user_postun"
    - "%systemd_user_postun_with_restart"

  # Skip %check section - cannot run cross-compiled tests on build host
  skip_check: true

  # Autoconf cache overrides - IRIX malloc/realloc return non-null for size 0
  ac_cv_overrides:
    ac_cv_func_malloc_0_nonnull: "yes"
    ac_cv_func_realloc_0_nonnull: "yes"

  # RPM macros injected directly (replaces sgug-rpm-config)
  rpm_macros:
    # Target architecture for cross-compilation
    _target_cpu: mips
    _arch: mips
    # Disable automatic dependency detection - IRIX system libs aren't in RPM db
    __find_requires: "%{nil}"
    __find_provides: "%{nil}"
    _prefix: /usr/sgug
    _exec_prefix: /usr/sgug
    _bindir: /usr/sgug/bin
    _sbindir: /usr/sgug/sbin
    _libdir: /usr/sgug/lib32
    _includedir: /usr/sgug/include
    _datadir: /usr/sgug/share
    _mandir: /usr/sgug/share/man
    _infodir: /usr/sgug/share/info
    _sysconfdir: /usr/sgug/etc
    _localstatedir: /usr/sgug/var
    # NOTE: Do NOT set _var - it's used by RPM for %_tmppath and must remain /var
    _sharedstatedir: /usr/sgug/var/lib
    _docdir: /usr/sgug/share/doc
    _pkgdocdir: "%{_docdir}/%{name}"
    _pkglicensedir: "%{_datadir}/licenses/%{name}"

  configure_disable:
    - selinux
    - systemd
    - udev
    - inotify
    - epoll
    - fanotify
    - timerfd
    - libcap
    - audit

  rewrite_paths:
    /usr/lib64: /usr/sgug/lib32
    /usr/lib: /usr/sgug/lib32
    /usr/include: /usr/sgug/include

  header_overlays:
    - generic

  drop_subpackages:
    - "debuginfo"
    - "debugsource"
    - "langpack-*"
