package: zip

rules:
  inject_compat_functions:
    - stpcpy

  drop_buildrequires: []

  # Drop runtime dependency on unzip (may not be installed yet)
  drop_requires:
    - unzip

  spec_replacements:
    # Replace the build command entirely. Same approach as unzip:
    # - Skip generic_gcc (recursively sets CC=gcc)
    # - Skip unix/configure (sets conflicting flags during cross-compilation)
    # - Use known-good flags for IRIX directly with 'zips' target
    - pattern: |
        %{make_build} -f unix/Makefile prefix=%{_prefix} "CFLAGS_NOOPT=-I. -DUNIX $RPM_OPT_FLAGS" generic_gcc
      replacement: |
        %{make_build} -f unix/Makefile prefix=%{_prefix} \
          CC="%{__cc}" BIND="%{__cc}" CPP="%{__cc} -E" \
          "CFLAGS=-include strings.h -I. -DUNIX %{optflags} -DHAVE_DIRENT_H -DHAVE_TERMIOS_H -DUSE_BZIP2 -DLARGE_FILE_SUPPORT" \
          AS="%{__cc} -c" \
          LFLAGS2="-L$(pwd)/mogrix-compat -lmogrix-compat -lbz2" \
          zips

    # Fix typo in spec: RPM_BULD_ROOT â†’ RPM_BUILD_ROOT
    - pattern: "$RPM_BULD_ROOT"
      replacement: "$RPM_BUILD_ROOT"

