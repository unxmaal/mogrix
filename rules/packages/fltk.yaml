package: fltk

add_patch:
  - fltk.sgiremoveldsetversion.patch
  - fltk.sgiavoidsgiextensions.patch

upstream:
  url: https://github.com/fltk/fltk/releases/download/release-1.3.11/fltk-1.3.11-source.tar.gz
  version: "1.3.11"
  type: tarball
  build_system: autoconf
  license: LGPLv2+
  summary: "C++ user interface toolkit"
  source_dir: fltk-1.3.11

rules:
  # SGUG-RSE disabled GL, Xrender, Xfixes, Xft for IRIX
  configure_flags:
    add:
      - --with-links
      - --disable-localjpeg
      - --disable-localzlib
      - --disable-localpng
      - --enable-shared
      - --enable-threads
      - --disable-gl
      - --disable-xrender
      - --disable-xfixes
      - --disable-xft
      - --disable-xdbe
      - --disable-xinerama

  export_vars:
    CFLAGS: "-pthread"
    CXXFLAGS: "-pthread"
    LIBS: "-lgcc_s -lc -lm -lpthread"

  prep_commands:
    # Regenerate configure after patching configure.ac
    - "autoconf"
    # Verbose build output
    - "sed -i '/.SILENT:/d' makeinclude.in"
    # Skip building fluid (MIPS binary can't run on build host) and test programs
    - "sed -i 's|DIRS = $(IMAGEDIRS) src $(CAIRODIR) fluid test documentation|DIRS = $(IMAGEDIRS) src $(CAIRODIR)|' Makefile"

  install_cleanup:
    - "rm -rf $RPM_BUILD_ROOT%{_mandir}/cat*"
    - "rm -rf $RPM_BUILD_ROOT%{_docdir}/fltk"

  drop_buildrequires:
    - xorg-x11-utils

  explicit_provides:
    - "fltk"
    - "fltk-devel"
    - "libfltk"
