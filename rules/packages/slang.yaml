package: slang
rules:
  drop_buildrequires:
  - pcre-devel
  configure_disable:
  - png
  - pcre
  - onig
  prep_commands:
  - '$MOGRIX_ROOT/tools/safepatch src/slutty.c --insert-top ''#include <fcntl.h>'' --no-backup --quiet'
  - "$MOGRIX_ROOT/tools/safepatch modules/slsmg-module.c --old '#include <slang.h>' --insert-after 'extern int SLtt_write_to_status_line(const char *, int);' --no-backup --quiet"
  spec_replacements:
  - pattern: --with-{png,z}lib=%{_libdir}
    replacement: --with-pnglib=%{_libdir} --with-zlib=%{_libdir}
  - pattern: --with-{png,z}inc=%{_includedir}
    replacement: --with-pnginc=%{_includedir} --with-zinc=%{_includedir}
  - pattern: '# fails with %{?_smp_mflags}'
    replacement: '# Remove sincos/sincosf â€” GNU extensions not on IRIX

      sed -i ''s/^#define HAVE_SINCOS.*/#undef HAVE_SINCOS/'' src/sysconf.h

      sed -i ''s/^#define HAVE_SINCOSF.*/#undef HAVE_SINCOSF/'' src/sysconf.h

      sed -i ''s/^#define HAVE_FENV_H.*/#undef HAVE_FENV_H/'' src/sysconf.h

      sed -i ''s/^#define HAVE_FECLEAREXCEPT.*/#undef HAVE_FECLEAREXCEPT/'' src/sysconf.h

      # fails with %{?_smp_mflags}'
  - pattern: export ac_cv_header_sys_random_h="no"
    replacement: 'export ac_cv_header_sys_random_h="no"

      export ac_cv_lib_m_sincos=no

      export ac_cv_lib_m_sincosf=no'
  - pattern: rm -rf $RPM_BUILD_ROOT%{_docdir}/{slang,slsh}
    replacement: rm -rf $RPM_BUILD_ROOT%{_docdir}/slang $RPM_BUILD_ROOT%{_docdir}/slsh
