# glib2 - GLib library
# Has sgifixes patches, needs compat functions

package: glib2


# IRIX-specific patches from SGUG-RSE
add_patch:
  - glib2.sgifixes.patch

rules:
  # Compat functions needed
  inject_compat_functions:
    - strdup
    - strndup
    - getline
    - asprintf
    - vasprintf

  # NOTE: libdicl/systemtap-sdt-devel/libselinux-devel drop_buildrequires/drop_requires handled by generic.yaml
  drop_buildrequires:
    - libmount-devel

  # Autoconf cache overrides
  # NOTE: ac_cv_func_malloc/realloc_0_nonnull handled by generic.yaml
  ac_cv_overrides:
    glib_cv_stack_grows: "no"
    glib_cv_uscore: "no"
    ac_cv_func_posix_getpwuid_r: "yes"
    ac_cv_func_posix_getgrgid_r: "yes"

  # GLib uses meson, so configure_flags won't work directly
  # These are meson options that need special handling
  # For now, document them
  #
  # Meson options for IRIX:
  # -Dselinux=disabled
  # -Dsystemtap=disabled
  # -Ddtrace=false
  # -Dlibmount=disabled
  # -Dman=false
  # -Dgtk_doc=false

  # NOTE: libdicl remove_lines handled by generic.yaml

  # Comment out systemd conditionals
  comment_conditionals:
    - with_systemd
