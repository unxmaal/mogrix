package: gawk
classes:
- nls-disabled
smoke_test:
- command: echo 'a b c' | /usr/sgug/bin/gawk '{print $2}'
  expect: b
- command: /usr/sgug/bin/gawk --version
  expect: 5.3.0
rules:
  drop_buildrequires:
  - ghostscript
  - glibc-all-langpacks
  - texinfo-tex
  - texlive-cm-super
  - texlive-ec
  configure_flags:
    add:
    - --without-mpfr
  prep_commands:
  - "for f in node.c re.c support/pma.c builtin.c; do $MOGRIX_ROOT/tools/safepatch $f --old '%zu' --new '%u' --count 0 --no-backup --quiet || :; $MOGRIX_ROOT/tools/safepatch $f --old '%zd' --new '%d' --count 0 --no-backup --quiet || :; $MOGRIX_ROOT/tools/safepatch $f --old '%zx' --new '%x' --count 0 --no-backup --quiet || :; done"
  - "$MOGRIX_ROOT/tools/safepatch support/malloc/dynarray_at_failure.c --old '%zu' --new '%u' --count 0 --no-backup --quiet"
  - "$MOGRIX_ROOT/tools/safepatch Makefile.am --old ' test' --new '' --no-backup --quiet"
  drop_subpackages:
  - doc
  - all-langpacks
  install_cleanup:
  - rm -rf %{buildroot}%{_pkgdocdir}
  - rm -rf %{buildroot}%{_infodir}
  spec_replacements:
  - pattern: '%autosetup -N -S git'
    replacement: '%autosetup -N'
  - pattern: git add --all --force .
    replacement: '# git add removed (cross-build)'
  - pattern: git commit --all --amend --no-edit > /dev/null
    replacement: '# git commit removed (cross-build)'
  - pattern: '%make_build -C doc pdf'
    replacement: '# doc building skipped (cross-build)'
  - pattern: mkdir -p html/gawk html/gawkinet
    replacement: '# html doc building skipped (cross-build)'
  - pattern: makeinfo --html -I doc -o html/gawk     doc/gawk.texi
    replacement: '# makeinfo skipped'
  - pattern: makeinfo --html -I doc -o html/gawkinet doc/gawkinet.texi
    replacement: '# makeinfo skipped'
  - pattern: install -m 0755 -d %{buildroot}%{_docdir}/%{name}/html/gawk/
    replacement: '# doc install skipped (cross-build)'
  - pattern: install -m 0755 -d %{buildroot}%{_docdir}/%{name}/html/gawkinet/
    replacement: '# doc install skipped'
  - pattern: install -m 0755 -d %{buildroot}%{_docdir}/%{name}/eg/data/
    replacement: '# doc install skipped'
  - pattern: install -m 0644 -p html/gawk/*           %{buildroot}%{_docdir}/%{name}/html/gawk/
    replacement: '# doc install skipped'
  - pattern: install -m 0644 -p html/gawkinet/*       %{buildroot}%{_docdir}/%{name}/html/gawkinet/
    replacement: '# doc install skipped'
  - pattern: install -m 0644 -p doc/gawk.{pdf,ps}     %{buildroot}%{_docdir}/%{name}
    replacement: '# doc install skipped'
  - pattern: install -m 0644 -p doc/gawkinet.{pdf,ps} %{buildroot}%{_docdir}/%{name}
    replacement: '# doc install skipped'
  - pattern: install -m 0644 -p awklib/eg/data/* %{buildroot}%{_docdir}/%{name}/eg/data/
    replacement: '# doc install skipped'
  - pattern: '%{_infodir}/*awk*.info*'
    replacement: '# infodir removed (install_cleanup)'
  - pattern: ln -sf /usr/share/awk   %{buildroot}%{_datadir}/gawk
    replacement: '# symlink removed (cross-build)'
  - pattern: ln -sf /usr/sgug/lib32exec/awk %{buildroot}%{_libexecdir}/gawk
    replacement: '# symlink removed (cross-build)'
