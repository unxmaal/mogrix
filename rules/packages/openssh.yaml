package: openssh
add_source:
- explicit_bzero.irix.c
- digest-openssl.irix.c
- charclass.irix.h
- cipher-evptype-dispatch.c
smoke_test:
- command: /usr/sgug/bin/ssh -V
  expect: OpenSSH_9.6
rules:
  drop_buildrequires:
  - pam-devel
  - libfido2-devel
  - p11-kit-devel
  - gtk3-devel
  - gtk2-devel
  - libX11-devel
  - perl-podlators
  - groff
  - util-linux
  - xauth
  - libedit-devel
  - krb5-devel
  - systemd-rpm-macros
  drop_requires:
  - /sbin/nologin
  - crypto-policies
  - pam
  - /usr/sbin/useradd
  - p11-kit
  drop_subpackages:
  - keycat
  - askpass
  ac_cv_overrides:
    ac_cv_func__getpty: 'yes'
    ac_cv_func_setrlimit: 'yes'
    ac_cv_func_b64_ntop: 'no'
    ac_cv_func___b64_ntop: 'no'
    ac_cv_func_b64_pton: 'no'
    ac_cv_func___b64_pton: 'no'
    ac_cv_func_BN_is_prime_ex: 'yes'
    ac_cv_func_DSA_generate_parameters_ex: 'yes'
    ac_cv_func_EC_KEY_METHOD_new: 'yes'
    ac_cv_func_EVP_CIPHER_CTX_get_updated_iv: 'yes'
    ac_cv_func_EVP_CIPHER_CTX_iv: 'yes'
    ac_cv_func_EVP_CIPHER_CTX_iv_noconst: 'yes'
    ac_cv_func_EVP_PKEY_get_raw_private_key: 'yes'
    ac_cv_func_EVP_PKEY_get_raw_public_key: 'yes'
    ac_cv_func_EVP_sha256: 'yes'
    ac_cv_func_EVP_sha384: 'yes'
    ac_cv_func_EVP_sha512: 'yes'
    ac_cv_func_OpenSSL_version: 'yes'
    ac_cv_func_OpenSSL_version_num: 'yes'
    ac_cv_func_RSA_generate_key_ex: 'yes'
  configure_flags:
    add:
    - --with-sandbox=no
    - --without-pam
    - --without-systemd
    - --without-security-key-builtin
    - --with-privsep-user=sshd
    - --with-ssl-dir=/usr/sgug
    - --with-zlib=/usr/sgug
  remove_lines:
  - '%sysusers_create_compat'
  spec_replacements:
  - pattern: '%global WITH_SELINUX 1'
    replacement: '%global WITH_SELINUX 0'
  - pattern: '%global no_gnome_askpass 0'
    replacement: '%global no_gnome_askpass 1'
  - pattern: '%global pie 1'
    replacement: '%global pie 0'
  - pattern: '%global kerberos5 1'
    replacement: '%global kerberos5 0'
  - pattern: '%global libedit 1'
    replacement: '%global libedit 0'
  - pattern: '%global pam_ssh_agent 1'
    replacement: '%global pam_ssh_agent 0'
  - pattern: "\t--with-systemd \\"
    replacement: "\t\\"
  - pattern: "\t--with-default-pkcs11-provider=yes \\"
    replacement: "\t\\"
  - pattern: "\t--with-security-key-builtin=yes \\"
    replacement: "\t\\"
  - pattern: "\t--with-pam \\"
    replacement: "\t\\"
  - pattern: '%files keycat

      %doc HOWTO.ssh-keycat

      %attr(0755,root,root) %{_libexecdir}/openssh/ssh-keycat

      %attr(0644,root,root) %config(noreplace) /etc/pam.d/ssh-keycat'
    replacement: '# %files keycat (disabled for IRIX)

      # %doc HOWTO.ssh-keycat

      # %attr ssh-keycat

      # %attr /etc/pam.d/ssh-keycat'
  - pattern: '%if ! %{no_gnome_askpass}

      %files askpass

      %attr(0644,root,root) %{_sysconfdir}/profile.d/gnome-ssh-askpass.*

      %attr(0755,root,root) %{_libexecdir}/openssh/gnome-ssh-askpass

      %attr(0755,root,root) %{_libexecdir}/openssh/ssh-askpass

      %endif'
    replacement: '# %if ! %{no_gnome_askpass}  (disabled for IRIX)

      # %files askpass (disabled)

      # %attr gnome-ssh-askpass.*

      # %attr gnome-ssh-askpass

      # %attr ssh-askpass

      # %endif'
  - pattern: '%files sk-dummy

      %attr(0755,root,root) %{_libdir}/sshtest/sk-dummy.so'
    replacement: '# %files sk-dummy (disabled for IRIX)

      # %attr sk-dummy.so'
  - pattern: '%package sk-dummy

      Summary: OpenSSH SK driver for test purposes

      Requires: openssh = %{version}-%{release}'
    replacement: '# %package sk-dummy  # disabled for IRIX

      # Summary: OpenSSH SK driver (disabled)

      # Requires: openssh (sk-dummy disabled)'
  - pattern: '%description sk-dummy

      This package contains a test SK driver used for OpenSSH test purposes'
    replacement: '# %description sk-dummy (disabled)

      # (test SK driver disabled)'
  - pattern: '%package -n pam_ssh_agent_auth'
    replacement: '# %package -n pam_ssh_agent_auth  # disabled for IRIX'
  - pattern: 'Summary: PAM module for authentication with ssh-agent'
    replacement: '# Summary: PAM module (pam_ssh_agent_auth disabled)'
  - pattern: 'Version: %{pam_ssh_agent_ver}'
    replacement: '# Version: pam_ssh_agent (disabled)'
  - pattern: 'Release: %{pam_ssh_agent_rel}.%{openssh_rel}%{?dist}.2'
    replacement: '# Release: pam_ssh_agent (disabled)'
  - pattern: 'License: BSD-3-Clause AND BSD-2-Clause AND ISC AND SSH-OpenSSH AND ssh-keyscan AND sprintf AND LicenseRef-Fedora-Public-Domain AND X11-distribute-modifications-variant AND OpenSSL'
    replacement: '# License: pam_ssh_agent (disabled)'
  - pattern: '%description -n pam_ssh_agent_auth'
    replacement: '# %description -n pam_ssh_agent_auth  # disabled for IRIX'
  - pattern: This package contains a PAM module which can be used to authenticate
    replacement: '# (pam_ssh_agent_auth description disabled)'
  - pattern: users using ssh keys stored in a ssh-agent. Through the use of the
    replacement: '#'
  - pattern: forwarding of ssh-agent connection it also allows to authenticate with
    replacement: '#'
  - pattern: remote ssh-agent instance.
    replacement: '#'
  - pattern: The module is most useful for su and sudo service stacks.
    replacement: '#'
  - pattern: 'pushd pam_ssh_agent_auth-pam_ssh_agent_auth-%{pam_ssh_agent_ver}

      autoreconf

      popd'
    replacement: '# pam_ssh_agent_auth autoreconf disabled (pam_ssh_agent=0)'
  - pattern: gpgv2 --quiet --keyring %{SOURCE3} %{SOURCE1} %{SOURCE0}
    replacement: '# gpgv2 verification disabled for cross-build'
  - pattern: '%patch -P 400 -p1 -b .role-mls'
    replacement: '# %patch -P 400 disabled (SELinux)'
  - pattern: '%patch -P 404 -p1 -b .privsep-selinux'
    replacement: '# %patch -P 404 disabled (SELinux)'
  - pattern: '%patch -P 502 -p1 -b .keycat'
    replacement: '# %patch -P 502 disabled (SELinux keycat)'
  - pattern: '%patch -P 601 -p1 -b .ip-opts'
    replacement: '# %patch -P 601 disabled (all Fedora patches dropped)'
  - pattern: '%patch -P 606 -p1 -b .ipv6man'
    replacement: '# %patch -P 606 disabled'
  - pattern: '%patch -P 607 -p1 -b .sigpipe'
    replacement: '# %patch -P 607 disabled'
  - pattern: '%patch -P 609 -p1 -b .x11'
    replacement: '# %patch -P 609 disabled'
  - pattern: '%patch -P 702 -p1 -b .progress'
    replacement: '# %patch -P 702 disabled'
  - pattern: '%patch -P 703 -p1 -b .grab-info'
    replacement: '# %patch -P 703 disabled'
  - pattern: '%patch -P 707 -p1 -b .redhat'
    replacement: '# %patch -P 707 disabled (Fedora defaults)'
  - pattern: '%patch -P 711 -p1 -b .log-usepam-no'
    replacement: '# %patch -P 711 disabled (PAM)'
  - pattern: '%patch -P 800 -p1 -b .gsskex'
    replacement: '# %patch -P 800 disabled (GSSAPI)'
  - pattern: '%patch -P 801 -p1 -b .force_krb'
    replacement: '# %patch -P 801 disabled (Kerberos)'
  - pattern: '%patch -P 804 -p1 -b .ccache_name'
    replacement: '# %patch -P 804 disabled (GSSAPI)'
  - pattern: '%patch -P 805 -p1 -b .k5login'
    replacement: '# %patch -P 805 disabled (Kerberos)'
  - pattern: '%patch -P 901 -p1 -b .kuserok'
    replacement: '# %patch -P 901 disabled (Kerberos)'
  - pattern: '%patch -P 906 -p1 -b .fromto-remote'
    replacement: '# %patch -P 906 disabled'
  - pattern: '%patch -P 916 -p1 -b .contexts'
    replacement: '# %patch -P 916 disabled (SELinux)'
  - pattern: '%patch -P 918 -p1 -b .log-in-chroot'
    replacement: '# %patch -P 918 disabled'
  - pattern: '%patch -P 919 -p1 -b .scp'
    replacement: '# %patch -P 919 disabled'
  - pattern: '%patch -P 802 -p1 -b .GSSAPIEnablek5users'
    replacement: '# %patch -P 802 disabled (GSSAPI)'
  - pattern: '%patch -P 922 -p1 -b .sshdt'
    replacement: '# %patch -P 922 disabled'
  - pattern: '%patch -P 926 -p1 -b .sftp-force-mode'
    replacement: '# %patch -P 926 disabled'
  - pattern: '%patch -P 939 -p1 -b .s390-dev'
    replacement: '# %patch -P 939 disabled (s390)'
  - pattern: '%patch -P 944 -p1 -b .x11max'
    replacement: '# %patch -P 944 disabled'
  - pattern: '%patch -P 948 -p1 -b .systemd'
    replacement: '# %patch -P 948 disabled (systemd)'
  - pattern: '%patch -P 949 -p1 -b .refactor'
    replacement: '# %patch -P 949 disabled (SELinux)'
  - pattern: '%patch -P 950 -p1 -b .sandbox'
    replacement: '# %patch -P 950 disabled (Linux sandbox)'
  - pattern: '%patch -P 951 -p1 -b .pkcs11-uri'
    replacement: '# %patch -P 951 disabled (PKCS#11)'
  - pattern: '%patch -P 953 -p1 -b .scp-ipv6'
    replacement: '# %patch -P 953 disabled'
  - pattern: '%patch -P 962 -p1 -b .crypto-policies'
    replacement: '# %patch -P 962 disabled (crypto-policies)'
  - pattern: '%patch -P 963 -p1 -b .openssl-evp'
    replacement: '# %patch -P 963 disabled (OpenSSL EVP)'
  - pattern: '%patch -P 964 -p1 -b .openssl-kdf'
    replacement: '# %patch -P 964 disabled (OpenSSL KDF)'
  - pattern: '%patch -P 965 -p1 -b .visibility'
    replacement: '# %patch -P 965 disabled'
  - pattern: '%patch -P 966 -p1 -b .x11-ipv6'
    replacement: '# %patch -P 966 disabled'
  - pattern: '%patch -P 974 -p1 -b .keygen-strip-doseol'
    replacement: '# %patch -P 974 disabled'
  - pattern: '%patch -P 975 -p1 -b .preserve-pam-errors'
    replacement: '# %patch -P 975 disabled (PAM)'
  - pattern: '%patch -P 977 -p1 -b .kill-scp'
    replacement: '# %patch -P 977 disabled'
  - pattern: '%patch -P 981 -p1 -b .scp-sftpdirs'
    replacement: '# %patch -P 981 disabled'
  - pattern: '%patch -P 982 -p1 -b .minrsabits'
    replacement: '# %patch -P 982 disabled'
  - pattern: '%patch -P 984 -p1 -b .ibmca'
    replacement: '# %patch -P 984 disabled (IBM)'
  - pattern: '%patch -P 200 -p1 -b .audit'
    replacement: '# %patch -P 200 disabled (audit)'
  - pattern: '%patch -P 201 -p1 -b .audit-race'
    replacement: '# %patch -P 201 disabled (audit)'
  - pattern: '%patch -P 202 -p1 -b .audit-log'
    replacement: '# %patch -P 202 disabled (audit)'
  - pattern: '%patch -P 700 -p1 -b .fips'
    replacement: '# %patch -P 700 disabled (FIPS)'
  - pattern: '%patch -P 1002 -p1 -b .ssh-manpage'
    replacement: '# %patch -P 1002 disabled'
  - pattern: '%patch -P 1006 -p1 -b .negotiate-supported-algs'
    replacement: '# %patch -P 1006 disabled'
  - pattern: '%patch -P 1012 -p1 -b .evp-fips-dh'
    replacement: '# %patch -P 1012 disabled (FIPS)'
  - pattern: '%patch -P 1013 -p1 -b .evp-fips-ecdh'
    replacement: '# %patch -P 1013 disabled (FIPS)'
  - pattern: '%patch -P 1014 -p1 -b .nosha1hostproof'
    replacement: '# %patch -P 1014 disabled (FIPS)'
  - pattern: '%patch -P 100 -p1 -b .coverity'
    replacement: '# %patch -P 100 disabled'
  - pattern: '%set_build_flags'
    replacement: '# %set_build_flags  # not available for cross-build'
  - pattern: CFLAGS="$CFLAGS -fvisibility=hidden"; export CFLAGS
    replacement: '# -fvisibility=hidden disabled for IRIX cross-build'
  - pattern: make regress/misc/sk-dummy/sk-dummy.so
    replacement: '# sk-dummy.so build disabled (no FIDO2)'
  - pattern: '%configure \'
    replacement: 'CFLAGS="$CFLAGS -DBROKEN_SNPRINTF -Dgetdelim=getdelim -Dgetline=getline -Dasprintf=asprintf -Dvasprintf=vasprintf -DOPENSSL_HAS_ECC -DOPENSSL_HAS_NISTP256 -DOPENSSL_HAS_NISTP384 -DOPENSSL_HAS_NISTP521
      -DHAVE_EC_KEY_METHOD_NEW"

      export CFLAGS

      %configure \'
  - pattern: --with-default-path=/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
    replacement: --with-default-path=/usr/sgug/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
  - pattern: --with-superuser-path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
    replacement: --with-superuser-path=/usr/sgug/sbin:/usr/sgug/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
  - pattern: install -d $RPM_BUILD_ROOT/etc/pam.d/
    replacement: '# PAM disabled for IRIX'
  - pattern: install -m644 %{SOURCE2} $RPM_BUILD_ROOT/etc/pam.d/sshd
    replacement: '# PAM disabled'
  - pattern: install -m644 %{SOURCE6} $RPM_BUILD_ROOT/etc/pam.d/ssh-keycat
    replacement: '# PAM disabled'
  - pattern: install -d $RPM_BUILD_ROOT/etc/sysconfig/
    replacement: '# sysconfig disabled for IRIX'
  - pattern: install -m644 %{SOURCE7} $RPM_BUILD_ROOT/etc/sysconfig/sshd
    replacement: '# sysconfig disabled'
  - pattern: install -m644 ssh_config_redhat $RPM_BUILD_ROOT%{_sysconfdir}/ssh/ssh_config.d/50-redhat.conf
    replacement: '# Fedora crypto-policies config disabled for IRIX'
  - pattern: install -m644 sshd_config_redhat_cp $RPM_BUILD_ROOT%{_sysconfdir}/ssh/sshd_config.d/40-redhat-crypto-policies.conf
    replacement: '# crypto-policies config disabled for IRIX'
  - pattern: install -m644 sshd_config_redhat $RPM_BUILD_ROOT%{_sysconfdir}/ssh/sshd_config.d/50-redhat.conf
    replacement: '# Fedora sshd config disabled for IRIX'
  - pattern: install -d -m755 $RPM_BUILD_ROOT/%{_unitdir}
    replacement: '# systemd disabled for IRIX'
  - pattern: install -m644 %{SOURCE9} $RPM_BUILD_ROOT/%{_unitdir}/sshd@.service
    replacement: '# systemd disabled'
  - pattern: install -m644 %{SOURCE10} $RPM_BUILD_ROOT/%{_unitdir}/sshd.socket
    replacement: '# systemd disabled'
  - pattern: install -m644 %{SOURCE11} $RPM_BUILD_ROOT/%{_unitdir}/sshd.service
    replacement: '# systemd disabled'
  - pattern: install -m644 %{SOURCE12} $RPM_BUILD_ROOT/%{_unitdir}/sshd-keygen@.service
    replacement: '# systemd disabled'
  - pattern: install -m644 %{SOURCE15} $RPM_BUILD_ROOT/%{_unitdir}/sshd-keygen.target
    replacement: '# systemd disabled'
  - pattern: install -d -m755 $RPM_BUILD_ROOT/%{_userunitdir}
    replacement: '# systemd user units disabled'
  - pattern: install -m644 %{SOURCE16} $RPM_BUILD_ROOT/%{_userunitdir}/ssh-agent.service
    replacement: '# systemd disabled'
  - pattern: install -m644 %{SOURCE17} $RPM_BUILD_ROOT/%{_userunitdir}/ssh-agent.socket
    replacement: '# systemd disabled'
  - pattern: install -p -D -m 0644 %{SOURCE19} %{buildroot}%{_sysusersdir}/openssh-server.conf
    replacement: '# sysusers disabled for IRIX'
  - pattern: install -m744 %{SOURCE20} $RPM_BUILD_ROOT/%{_libexecdir}/openssh/ssh-host-keys-migration.sh
    replacement: '# host-keys-migration disabled (systemd)'
  - pattern: install -m644 %{SOURCE21} $RPM_BUILD_ROOT/%{_unitdir}/ssh-host-keys-migration.service
    replacement: '# host-keys-migration disabled (systemd)'
  - pattern: install -d $RPM_BUILD_ROOT/%{_localstatedir}/lib
    replacement: '# localstatedir disabled for IRIX'
  - pattern: touch $RPM_BUILD_ROOT/%{_localstatedir}/lib/.ssh-host-keys-migration
    replacement: '# host-keys-migration ghost disabled'
  - pattern: install -m 755 -d $RPM_BUILD_ROOT%{_libdir}/sshtest/
    replacement: '# sk-dummy disabled (no FIDO2)'
  - pattern: install -m 755 regress/misc/sk-dummy/sk-dummy.so $RPM_BUILD_ROOT%{_libdir}/sshtest
    replacement: '# sk-dummy disabled'
  - pattern: perl -pi -e "s|$RPM_BUILD_ROOT||g" $RPM_BUILD_ROOT%{_mandir}/man*/*
    replacement: find $RPM_BUILD_ROOT%{_mandir} -type f -exec sed -i "s|$RPM_BUILD_ROOT||g" {} +
  - pattern: '%attr(0644,root,root) %{_unitdir}/sshd.service'
    replacement: '# systemd units removed for IRIX'
  - pattern: '%attr(0644,root,root) %{_unitdir}/sshd@.service'
    replacement: '# systemd disabled'
  - pattern: '%attr(0644,root,root) %{_unitdir}/sshd.socket'
    replacement: '# systemd disabled'
  - pattern: '%attr(0644,root,root) %{_unitdir}/sshd-keygen@.service'
    replacement: '# systemd disabled'
  - pattern: '%attr(0644,root,root) %{_unitdir}/sshd-keygen.target'
    replacement: '# systemd disabled'
  - pattern: '%attr(0644,root,root) %{_sysusersdir}/openssh-server.conf'
    replacement: '# sysusers disabled'
  - pattern: '%attr(0644,root,root) %{_unitdir}/ssh-host-keys-migration.service'
    replacement: '# migration service disabled'
  - pattern: '%attr(0744,root,root) %{_libexecdir}/openssh/ssh-host-keys-migration.sh'
    replacement: '# migration script disabled'
  - pattern: '%ghost %attr(0644,root,root) %{_localstatedir}/lib/.ssh-host-keys-migration'
    replacement: '# migration ghost disabled'
  - pattern: '%attr(0644,root,root) %config(noreplace) /etc/pam.d/sshd'
    replacement: '# PAM disabled for IRIX'
  - pattern: '%attr(0640,root,root) %config(noreplace) /etc/sysconfig/sshd'
    replacement: '# sysconfig disabled for IRIX'
  - pattern: '%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ssh/sshd_config.d/40-redhat-crypto-policies.conf'
    replacement: '# crypto-policies disabled for IRIX'
  - pattern: '%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ssh/sshd_config.d/50-redhat.conf'
    replacement: '# Fedora sshd config disabled for IRIX'
  - pattern: '%attr(0644,root,root) %{_userunitdir}/ssh-agent.service'
    replacement: '# systemd user service disabled'
  - pattern: '%attr(0644,root,root) %{_userunitdir}/ssh-agent.socket'
    replacement: '# systemd user socket disabled'
  - pattern: '%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ssh/ssh_config.d/50-redhat.conf'
    replacement: '# Fedora ssh config disabled for IRIX'
  - pattern: '%attr(0755,root,root) %{_libexecdir}/openssh/ssh-pkcs11-helper'
    replacement: '# PKCS#11 helper disabled'
  - pattern: '%attr(0644,root,root) %{_mandir}/man8/ssh-pkcs11-helper.8*'
    replacement: '# PKCS#11 man page disabled'
  - pattern: '%attr(0755,root,root) %{_libexecdir}/openssh/ssh-sk-helper'
    replacement: '# FIDO2 sk-helper disabled'
  - pattern: '%attr(0644,root,root) %{_mandir}/man8/ssh-sk-helper.8*'
    replacement: '# FIDO2 man page disabled'
  - pattern: '%{_mandir}/man1/ssh-keygen.1*'
    replacement: '%{_mandir}/man1/ssh-keygen.1'
  - pattern: '%{_mandir}/man8/ssh-keysign.8*'
    replacement: '%{_mandir}/man8/ssh-keysign.8'
  - pattern: '%{_mandir}/man1/ssh.1*'
    replacement: '%{_mandir}/man1/ssh.1'
  - pattern: '%{_mandir}/man1/scp.1*'
    replacement: '%{_mandir}/man1/scp.1'
  - pattern: '%{_mandir}/man5/ssh_config.5*'
    replacement: '%{_mandir}/man5/ssh_config.5'
  - pattern: '%{_mandir}/man1/ssh-agent.1*'
    replacement: '%{_mandir}/man1/ssh-agent.1'
  - pattern: '%{_mandir}/man1/ssh-add.1*'
    replacement: '%{_mandir}/man1/ssh-add.1'
  - pattern: '%{_mandir}/man1/ssh-keyscan.1*'
    replacement: '%{_mandir}/man1/ssh-keyscan.1'
  - pattern: '%{_mandir}/man1/sftp.1*'
    replacement: '%{_mandir}/man1/sftp.1'
  - pattern: '%{_mandir}/man1/ssh-copy-id.1*'
    replacement: '%{_mandir}/man1/ssh-copy-id.1'
  - pattern: '%{_mandir}/man5/sshd_config.5*'
    replacement: '%{_mandir}/man5/sshd_config.5'
  - pattern: '%{_mandir}/man5/moduli.5*'
    replacement: '%{_mandir}/man5/moduli.5'
  - pattern: '%{_mandir}/man8/sshd.8*'
    replacement: '%{_mandir}/man8/sshd.8'
  - pattern: '%{_mandir}/man8/sftp-server.8*'
    replacement: '%{_mandir}/man8/sftp-server.8'
  - pattern: if [ $1 -gt 1 ]; then
    replacement: '# migration disabled for IRIX

      if false; then'
  install_cleanup:
  - rm -rf %{buildroot}/etc/pam.d
  - rm -rf %{buildroot}/etc/sysconfig
  - rm -rf %{buildroot}%{_libdir}/sshtest
  - rm -f %{buildroot}%{_libexecdir}/openssh/ssh-pkcs11-helper
  - rm -f %{buildroot}%{_libexecdir}/openssh/ssh-sk-helper
  - rm -f %{buildroot}%{_mandir}/man8/ssh-pkcs11-helper.8
  - rm -f %{buildroot}%{_mandir}/man8/ssh-sk-helper.8
  prep_commands:
  - 'sed -i ''/#include "includes.h"/{ i\#define vsnprintf _irix_vsnprintf_decl\n#define snprintf _irix_snprintf_decl

    a\#undef vsnprintf\n#undef snprintf

    }'' openbsd-compat/bsd-snprintf.c'
  - cp %{_sourcedir}/explicit_bzero.irix.c openbsd-compat/explicit_bzero.c
  - cp %{_sourcedir}/digest-openssl.irix.c digest-openssl.c
  - cp %{_sourcedir}/cipher-evptype-dispatch.c .
  - "perl -0777 -pi -e '\n  s/(int\\ncipher_init\\(struct sshcipher_ctx)/#include \"cipher-evptype-dispatch.c\"\\n\\n$1/;\n  s/type = \\(\\*cipher->evptype\\)\\(\\);/type = ssh_cipher_evptype(cipher->name);/;\n\
    \  s/(CFLAG_CBC,\\s+)EVP_\\w+/${1}NULL/g;\n  s/(0,\\s+)EVP_aes_\\w+/${1}NULL/g;\n' cipher.c\n"
  - cp %{_sourcedir}/charclass.irix.h openbsd-compat/charclass.h
  - sed -i 's/cclasses\[idx\]\.isctype(k)/cclass_isctype(cclasses[idx].name, k)/g' openbsd-compat/glob.c
  - sed -i 's/cc->isctype((unsigned char)test)/cclass_isctype(cc->name, (unsigned char)test)/g' openbsd-compat/fnmatch.c
  - 'sed -i ''s/ensure_minimum_time_since(tstart,/\/\* IRIX: disabled \*\/ if(0) ensure_minimum_time_since(tstart,/'' auth2.c'
