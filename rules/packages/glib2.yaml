# glib2 - GLib library
# Has sgifixes patches, needs compat functions

package: glib2

rules:
  # Compat functions needed
  inject_compat_functions:
    - strdup
    - strndup
    - getline
    - asprintf
    - vasprintf

  # Drop libdicl dependency
  drop_buildrequires:
    - libdicl-devel
    - libdicl
    - systemtap-sdt-devel
    - libmount-devel
    - libselinux-devel

  drop_requires:
    - libdicl
    - libdicl-devel

  # Autoconf cache overrides
  ac_cv_overrides:
    ac_cv_func_malloc_0_nonnull: "yes"
    ac_cv_func_realloc_0_nonnull: "yes"
    glib_cv_stack_grows: "no"
    glib_cv_uscore: "no"
    ac_cv_func_posix_getpwuid_r: "yes"
    ac_cv_func_posix_getgrgid_r: "yes"

  # GLib uses meson, so configure_flags won't work directly
  # These are meson options that need special handling
  # For now, document them
  #
  # Meson options for IRIX:
  # -Dselinux=disabled
  # -Dsystemtap=disabled
  # -Ddtrace=false
  # -Dlibmount=disabled
  # -Dman=false
  # -Dgtk_doc=false

  # Remove libdicl setup lines
  remove_lines:
    - 'export CPPFLAGS="-I%{_includedir}/libdicl-0.1"'
    - 'export LIBS="-ldicl-0.1"'

  # Comment out systemd conditionals
  comment_conditionals:
    - with_systemd
