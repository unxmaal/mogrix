package: rsync
rules:
  ac_cv_overrides:
    ac_cv_type_long_double_wider: 'no'
  drop_buildrequires:
  - lz4-devel
  - xxhash-devel
  configure_flags:
    add:
    - --disable-lz4
    - --disable-xxhash
    - --enable-openssl
    - --enable-zstd
    - --enable-ipv6
    remove:
    - --enable-lz4
    - --enable-xxhash
  drop_subpackages:
  - daemon
  spec_replacements:
  - pattern: '%if %isprerelease

      %setup -q -n rsync-%{version}%{?prerelease}

      '
    replacement: '%if 0

      %setup -q -n rsync-%{version}%{?prerelease}

      '
  - pattern: '%patch 2 -p1 -b .buffer-overflow'
    replacement: "%patch 2 -p1 -b .buffer-overflow\n\n# Mogrix compat sources (re-injected â€” emitter put them in %if branch)\nmkdir -p mogrix-compat\nfor src in %{SOURCE100} %{SOURCE101} %{SOURCE102} %{SOURCE103}\
      \ %{SOURCE104} %{SOURCE105} %{SOURCE106}; do\n  cp \"$src\" mogrix-compat/\ndone\n"
  - pattern: install -D -m644 %{SOURCE3} $RPM_BUILD_ROOT/%{_unitdir}/rsyncd.service
    replacement: '# systemd services disabled for IRIX'
  - pattern: install -D -m644 %{SOURCE2} $RPM_BUILD_ROOT/%{_unitdir}/rsyncd.socket
    replacement: '# systemd socket disabled'
  - pattern: install -D -m644 %{SOURCE4} $RPM_BUILD_ROOT/%{_sysconfdir}/rsyncd.conf
    replacement: install -D -m644 %{SOURCE4} $RPM_BUILD_ROOT/%{_sysconfdir}/rsyncd.conf
  - pattern: install -D -m644 %{SOURCE5} $RPM_BUILD_ROOT/%{_sysconfdir}/sysconfig/rsyncd
    replacement: '# sysconfig disabled'
  - pattern: install -D -m644 %{SOURCE6} $RPM_BUILD_ROOT/%{_unitdir}/rsyncd@.service
    replacement: '# systemd template disabled'
  - pattern: '%post daemon

      '
    replacement: ''
  - pattern: '%preun daemon

      '
    replacement: ''
  - pattern: '%postun daemon

      '
    replacement: ''
