package: groff
rules:
  drop_buildrequires:
  - netpbm-progs
  - psutils
  - ghostscript
  drop_subpackages:
  - doc
  - x11
  install_cleanup:
  - rm -rf %{buildroot}%{_pkgdocdir}
  - rm -rf %{buildroot}%{_datadir}/X11
  - rm -f %{buildroot}%{_bindir}/gxditview
  - rm -f %{buildroot}%{_bindir}/xtotroff
  - rm -f %{buildroot}%{_mandir}/man1/gxditview.1
  - rm -f %{buildroot}%{_mandir}/man1/xtotroff.1
  - rm -rf %{buildroot}%{_datadir}/%{name}/%{version}/font/devX*
  - rm -f %{buildroot}%{_datadir}/%{name}/%{version}/tmac/X.tmac
  - rm -f %{buildroot}%{_datadir}/%{name}/%{version}/tmac/Xps.tmac
  - rm -f %{buildroot}%{_datadir}/%{name}/%{version}/font/FontMap-X11
  - rm -f %{buildroot}%{_libdir}/charset.alias
  spec_replacements:
  - pattern: '%autosetup -S git'
    replacement: '%autosetup -p1'
  - pattern: contrib/mom/examples/{README.txt,*.mom,mom.vim}
    replacement: contrib/mom/examples/README.txt contrib/mom/examples/*.mom contrib/mom/examples/mom.vim
  - pattern: '%make_build'
    replacement: '# Remove doc generation from ''all'' target (can''t run cross-compiled groff)

      sed -i ''/^all:.*doc\/groff\.info/d'' Makefile

      sed -i ''/^all:.*generate_man_files/d'' Makefile

      GROFF_NODOC="PROCESSEDEXAMPLEFILES= PROCESSEDEXAMPLEFILES_PS= PROCESSEDEXAMPLEFILES_HTML= HDTBLPROCESSEDEXAMPLEFILES= MOMPROCESSEDEXAMPLEFILES= PROCESSEDDOCFILES= PROCESSEDDOCFILES_PS= PROCESSEDDOCFILES_TXT=
      PROCESSEDDOCFILES_HTML= PROCESSEDDOCFILES_PDF= GENERATEDDOCFILES="

      %make_build $GROFF_NODOC

      '
  - pattern: '%make_install'
    replacement: 'GROFF_NODOC="PROCESSEDEXAMPLEFILES= PROCESSEDEXAMPLEFILES_PS= PROCESSEDEXAMPLEFILES_HTML= HDTBLPROCESSEDEXAMPLEFILES= MOMPROCESSEDEXAMPLEFILES= PROCESSEDDOCFILES= PROCESSEDDOCFILES_PS=
      PROCESSEDDOCFILES_TXT= PROCESSEDDOCFILES_HTML= PROCESSEDDOCFILES_PDF= GENERATEDDOCFILES="

      %make_install $GROFF_NODOC

      '
  - pattern: for file in g{nroff,troff,tbl,pic,eqn,neqn,refer,lookbib,indxbib,soelim} zsoelim; do
    replacement: for file in gnroff gtroff gtbl gpic geqn gneqn grefer glookbib gindxbib gsoelim zsoelim; do
  - pattern: ln -s ${file#?} %{buildroot}%{_bindir}/${file}
    replacement: ln -sf ${file#?} %{buildroot}%{_bindir}/${file}
  - pattern: ln -s ${file#?}.1.gz %{buildroot}%{_mandir}/man1/${file}.1.gz
    replacement: ln -sf ${file#?}.1 %{buildroot}%{_mandir}/man1/${file}.1
  - pattern: '# fix absolute symlink to relative symlink

      rm -f %{buildroot}%{_pkgdocdir}/pdf/mom-pdf.pdf

      ln -s ../examples/mom/mom-pdf.pdf %{buildroot}%{_pkgdocdir}/pdf/mom-pdf.pdf'
    replacement: '# pdf symlink skipped (no pdf docs in cross-build)'
  - pattern: "# remove CreationDate from documentation\npushd %{buildroot}%{_pkgdocdir}\n    find -name \"*.html\" | xargs sed -i \"/^<!-- CreationDate: /d\"\n    find -name \"*.ps\"   | xargs sed -i \"\
      /^%%%%CreationDate: /d\"\npopd"
    replacement: '# CreationDate removal skipped (no docs in cross-build)'
  - pattern: 'Requires(post): /usr/sbin/update-alternatives

      Requires(postun): /usr/sbin/update-alternatives

      Requires(preun): /usr/sbin/update-alternatives


      BuildRequires:'
    replacement: 'BuildRequires:'
  - pattern: 'Requires(post): /usr/sbin/update-alternatives

      Requires(postun): /usr/sbin/update-alternatives

      Requires(preun): /usr/sbin/update-alternatives


      %description base'
    replacement: '%description base'
