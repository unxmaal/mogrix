package: pango
rules:
  prep_commands:
  - sed -i "s/'-D_POSIX_C_SOURCE=200809L', //" meson.build
  - sed -i "s/^subdir('tests')/#subdir('tests')/" meson.build
  - sed -i "s/^subdir('examples')/#subdir('examples')/" meson.build
  - rm -rf subprojects/*.wrap
  drop_buildrequires:
  - gi-docgen
  - pkgconfig(gobject-introspection-1.0)
  - pkgconfig(libthai)
  spec_replacements:
  - pattern: "%meson \\\n  -Dinstall-tests=true \\\n  -Dgtk_doc=true\n\n%meson_build"
    replacement: "MOGRIX_CROSS=/home/edodd/projects/github/unxmaal/mogrix/cross/meson-irix-cross.ini\n# Create build-machine native file so meson finds host tools correctly\nmkdir -p _build_native_pkgconfig\n\
      cat > _build_native_pkgconfig/glib-2.0.pc << 'GLIBPC'\nprefix=/opt/faketemp/glib-dev-bin/usr\nbindir=${prefix}/bin\ndatadir=${prefix}/share\nName: GLib\nDescription: Build-machine GLib stub for cross-compile\n\
      Version: 2.80.0\nLibs:\nCflags:\nglib_genmarshal=${bindir}/glib-genmarshal\nglib_mkenums=${bindir}/glib-mkenums\ngobject_query=${bindir}/gobject-query\nGLIBPC\ncat > _build_native.ini << 'NATIVEOF'\n\
      [binaries]\npkgconfig = '/usr/bin/pkg-config'\n\n[built-in options]\npkg_config_path = ['_build_native_pkgconfig']\nNATIVEOF\nexport PATH=/opt/faketemp/glib-dev-bin/usr/bin:/opt/sgug-staging/usr/sgug/bin:$PATH\n\
      /home/edodd/.local/bin/meson setup _build \\\n  --cross-file=$MOGRIX_CROSS \\\n  --native-file=_build_native.ini \\\n  --prefix=%{_prefix} \\\n  --libdir=%{_libdir} \\\n  -Dgtk_doc=false \\\n  -Dintrospection=disabled\
      \ \\\n  -Dinstall-tests=false \\\n  -Dlibthai=disabled \\\n  -Dcairo=enabled \\\n  -Dfreetype=enabled \\\n  -Dfontconfig=enabled \\\n  -Dxft=enabled \\\n  -Dc_link_args=\"-L$COMPAT_DIR -lmogrix-compat\"\
      \ \\\n  --wrap-mode=nodownload\n/home/edodd/.local/bin/meson compile -C _build\n"
  - pattern: '%meson_install'
    replacement: DESTDIR=$RPM_BUILD_ROOT /home/edodd/.local/bin/meson install -C _build --no-rebuild
  - pattern: "PANGOXFT_SO=$RPM_BUILD_ROOT%{_libdir}/libpangoxft-1.0.so\nif ! test -e $PANGOXFT_SO; then\n        echo \"$PANGOXFT_SO not found; did not build with Xft support?\"\n        ls $RPM_BUILD_ROOT%{_libdir}\n\
      \        exit 1\nfi"
    replacement: '# pangoxft check removed for cross-build'
  - pattern: 'URL:     https://pango.gnome.org/'
    replacement: 'URL:     https://pango.gnome.org/

      Provides: libpango-1.0.so.0(mips-32)

      Provides: libpangocairo-1.0.so.0(mips-32)

      Provides: libpangoft2-1.0.so.0(mips-32)

      Provides: libpangoxft-1.0.so.0(mips-32)

      Provides: pango(mips-32) = %{version}-%{release}

      '
  - pattern: 'Requires: glib2%{?_isa} >= %{glib2_version}

      Requires: freetype%{?_isa} >= %{freetype_version}

      Requires: fontconfig%{?_isa} >= %{fontconfig_version}

      Requires: cairo%{?_isa} >= %{cairo_version}

      Requires: harfbuzz%{?_isa} >= %{harfbuzz_version}

      Requires: libthai%{?_isa} >= %{libthai_version}

      Requires: libXft%{?_isa} >= %{libXft_version}

      Requires: fribidi%{?_isa} >= %{fribidi_version}'
    replacement: 'Requires: glib2 >= %{glib2_version}

      Requires: freetype >= %{freetype_version}

      Requires: fontconfig >= %{fontconfig_version}

      Requires: cairo >= %{cairo_version}

      Requires: harfbuzz >= %{harfbuzz_version}

      Requires: fribidi >= %{fribidi_version}

      '
  - pattern: 'Requires: pango%{?_isa} = %{version}-%{release}

      Requires: glib2-devel%{?_isa} >= %{glib2_version}

      Requires: freetype-devel%{?_isa} >= %{freetype_version}

      Requires: fontconfig-devel%{?_isa} >= %{fontconfig_version}

      Requires: cairo-devel%{?_isa} >= %{cairo_version}'
    replacement: 'Requires: pango = %{version}-%{release}

      Requires: glib2-devel >= %{glib2_version}

      Requires: freetype-devel >= %{freetype_version}

      Requires: fontconfig-devel >= %{fontconfig_version}

      Requires: cairo-devel >= %{cairo_version}

      '
  - pattern: '%package doc

      Summary: Developer documentation for pango

      Requires: pango%{?_isa} = %{version}-%{release}

      # Because web fonts from upstream are not bundled in the gi-docgen package,

      # packages containing documentation generated with gi-docgen should depend on

      # this metapackage to ensure the proper system fonts are present.

      Recommends: gi-docgen-fonts


      %description doc

      The pango-doc package contains developer documentation for the pango package.'
    replacement: '# doc subpackage removed (no gi-docgen for cross)'
  - pattern: '%package tests

      Summary: Tests for the %{name} package

      Requires: %{name}%{?_isa} = %{version}-%{release}


      %description tests

      The %{name}-tests package contains tests that can be used to verify

      the functionality of the installed %{name} package.'
    replacement: '# tests subpackage removed'
  - pattern: '%files

      %license COPYING

      %doc NEWS README.md

      %{_libdir}/libpango*-*.so.*

      %{_bindir}/pango-list

      %{_bindir}/pango-segmentation

      %{_bindir}/pango-view

      %{_mandir}/man1/pango-view.1*

      %{_libdir}/girepository-1.0/Pango-1.0.typelib

      %{_libdir}/girepository-1.0/PangoCairo-1.0.typelib

      %{_libdir}/girepository-1.0/PangoFc-1.0.typelib

      %{_libdir}/girepository-1.0/PangoFT2-1.0.typelib

      %{_libdir}/girepository-1.0/PangoOT-1.0.typelib

      %{_libdir}/girepository-1.0/PangoXft-1.0.typelib'
    replacement: '%files

      %license COPYING

      %doc NEWS README.md

      %{_libdir}/libpango*-*.so.*

      %{_bindir}/pango-list

      %{_bindir}/pango-segmentation

      %{_bindir}/pango-view

      '
  - pattern: '%files devel

      %{_libdir}/libpango*.so

      %{_includedir}/*

      %{_libdir}/pkgconfig/*

      %{_datadir}/gir-1.0/Pango-1.0.gir

      %{_datadir}/gir-1.0/PangoCairo-1.0.gir

      %{_datadir}/gir-1.0/PangoFc-1.0.gir

      %{_datadir}/gir-1.0/PangoFT2-1.0.gir

      %{_datadir}/gir-1.0/PangoOT-1.0.gir

      %{_datadir}/gir-1.0/PangoXft-1.0.gir'
    replacement: '%files devel

      %{_libdir}/libpango*.so

      %{_includedir}/*

      %{_libdir}/pkgconfig/*

      '
  - pattern: '%files doc

      %{_docdir}/Pango/

      %{_docdir}/PangoCairo/

      %{_docdir}/PangoFT2/

      %{_docdir}/PangoFc/

      %{_docdir}/PangoOT/

      %{_docdir}/PangoXft/'
    replacement: '# doc files removed'
  - pattern: '%files tests

      %{_libexecdir}/installed-tests/%{name}

      %{_datadir}/installed-tests'
    replacement: '# tests files removed'
