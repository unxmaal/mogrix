# wget2 - GNU Wget2 HTTP/HTTPS downloader (FC40: 2.1.0)
# Autotools build. Core deps: gnutls, libidn2, pcre2, zlib, zstd, bzip2.
# Optional features disabled: brotli, nghttp2, libpsl, gpgme (not in staging).
package: wget2

rules:
  inject_compat_functions:
    - getline
    - strdup
    - strndup
    - strnlen
    - getopt_long

  drop_buildrequires:
    - doxygen
    - git-core
    - pandoc
    - lcov
    - lzip
    - gnupg2
    - python3
    - rsync
    - texinfo
    - "pkgconfig(gpgme)"
    - "pkgconfig(libbrotlidec)"
    - "pkgconfig(libmicrohttpd)"
    - "pkgconfig(libnghttp2)"
    - "pkgconfig(libpsl)"

  skip_find_lang: true

  spec_replacements:
    # Disable bcond as_wget — don't provide /usr/bin/wget alias on IRIX.
    # Use the outer %if/%else/%endif block approach to force as_wget 0.
    - pattern: "%bcond as_wget 1\n%endif"
      replacement: "%bcond as_wget 0\n%endif"
    # Remove %find_lang — locales are stripped by mogrix install_cleanup.
    # Also remove the -f reference in %files since we won't generate the lang file.
    - pattern: "%find_lang %{name}\n"
      replacement: ""
    - pattern: "%files -f %{name}.lang\n"
      replacement: "%files\n"
    # Install pre-built man page from tarball (pandoc unavailable for cross-build)
    - pattern: "%if 0%{?rhel}\n# tarball includes a pre-built manpage\ninstall -D -m0644 -t %{buildroot}%{_mandir}/man1/ docs/man/man1/wget2.1\n%endif"
      replacement: "# Install pre-built manpage from tarball (no pandoc for cross-build)\ninstall -D -m0644 -t %{buildroot}%{_mandir}/man1/ docs/man/man1/wget2.1"
    # Remove libwget API man pages from devel %files (generated by doxygen, which we dropped)
    - pattern: "%{_mandir}/man3/libwget*.3*\n"
      replacement: ""
