# popt - command line option parsing library
# Requires compat functions previously provided by libdicl

package: popt

rules:
  # Compat functions needed (replaces libdicl-devel dependency)
  inject_compat_functions:
    - strdup
    - strndup

  # Drop libdicl dependency (we inject compat sources instead)
  drop_buildrequires:
    - libdicl-devel
    - libdicl

  # Drop runtime Requires on libdicl
  drop_requires:
    - libdicl
    - libdicl-devel

  # Lines to remove (libdicl CPPFLAGS setup)
  remove_lines:
    - 'export CPPFLAGS="-I%{_includedir}/libdicl-0.1"'
    - 'export LIBS="-ldicl-0.1"'

  # Autoconf cache overrides for cross-compilation
  ac_cv_overrides:
    ac_cv_func_malloc_0_nonnull: "yes"
    ac_cv_func_realloc_0_nonnull: "yes"
    ac_cv_func_strerror_r_char_p: "no"
