package: curl
rules:
  drop_buildrequires:
  - krb5-devel
  drop_requires:
  - libnghttp2
  - libpsl
  - libssh
  export_vars:
    PKG_CONFIG_PATH: /opt/sgug-staging/usr/sgug/lib32/pkgconfig
    PKG_CONFIG_LIBDIR: /opt/sgug-staging/usr/sgug/lib32/pkgconfig
    PKG_CONFIG_SYSROOT_DIR: /opt/sgug-staging
    CPPFLAGS: -I/opt/sgug-staging/usr/sgug/include $CPPFLAGS
    LDFLAGS: -L/opt/sgug-staging/usr/sgug/lib32 $LDFLAGS
    LD: /opt/cross/bin/mips-sgi-irix6.5-ld.bfd
  ac_cv_overrides:
    curl_cv_func_recv_args: int,void *,size_t,int
    curl_cv_func_send_args: int,const void *,size_t,int
    lt_cv_path_LD: /opt/cross/bin/mips-sgi-irix6.5-ld.bfd
  configure_flags:
    add:
    - --enable-ipv6
    - --disable-ldap
    - --disable-ldaps
  configure_disable:
  - ldap
  - ldaps
  install_cleanup:
  - rm -f $RPM_BUILD_ROOT%{_libdir}/libcurl.la.minimal
  - rm -f $RPM_BUILD_ROOT%{_libdir}/libcurl.so.minimal
  spec_replacements:
  - pattern: mkdir build-{full,minimal}
    replacement: mkdir build-full build-minimal
  - pattern: build-{full,minimal}/libtool
    replacement: build-full/libtool build-minimal/libtool
  - pattern: --enable-ldap
    replacement: --disable-ldap
  - pattern: --enable-ldaps
    replacement: --disable-ldaps
  - pattern: --with-libpsl
    replacement: --without-libpsl
  - pattern: --with-libssh
    replacement: --without-libssh
  - pattern: --enable-threaded-resolver
    replacement: --disable-threaded-resolver
  - pattern: '%{_datadir}/zsh'
    replacement: '# %{_datadir}/zsh # zsh completions not built'
  - pattern: mv -v ${RPM_BUILD_ROOT}%{_bindir}/curl{,.minimal}
    replacement: mv -v ${RPM_BUILD_ROOT}%{_bindir}/curl ${RPM_BUILD_ROOT}%{_bindir}/curl.minimal
  - pattern: mv -v ${RPM_BUILD_ROOT}%{_bindir}/curl{,-%{version}}
    replacement: mv -v ${RPM_BUILD_ROOT}%{_bindir}/curl ${RPM_BUILD_ROOT}%{_bindir}/curl-%{version}
  - pattern: '# configure minimal build

      ('
    replacement: "# configure minimal build\n(\n    export CC=/opt/sgug-staging/usr/sgug/bin/irix-cc\n    export CXX=/opt/sgug-staging/usr/sgug/bin/irix-cxx\n    export AR=/opt/cross/bin/llvm-ar\n    export\
      \ RANLIB=/opt/cross/bin/llvm-ranlib\n    export LD=/opt/cross/bin/mips-sgi-irix6.5-ld.bfd\n    export CPPFLAGS=\"-I/opt/sgug-staging/usr/sgug/include\"\n    export LDFLAGS=\"-L/opt/sgug-staging/usr/sgug/lib32\""
  - pattern: '# configure full build

      ('
    replacement: "# configure full build\n(\n    export CC=/opt/sgug-staging/usr/sgug/bin/irix-cc\n    export CXX=/opt/sgug-staging/usr/sgug/bin/irix-cxx\n    export AR=/opt/cross/bin/llvm-ar\n    export\
      \ RANLIB=/opt/cross/bin/llvm-ranlib\n    export LD=/opt/cross/bin/mips-sgi-irix6.5-ld.bfd\n    export CPPFLAGS=\"-I/opt/sgug-staging/usr/sgug/include\"\n    export LDFLAGS=\"-L/opt/sgug-staging/usr/sgug/lib32\""
  - pattern: '    %configure $common_configure_opts   \'
    replacement: '    ../configure --prefix=/usr/sgug --exec-prefix=/usr/sgug --bindir=/usr/sgug/bin --sbindir=/usr/sgug/sbin --libdir=/usr/sgug/lib32 --includedir=/usr/sgug/include --datadir=/usr/sgug/share
      --mandir=/usr/sgug/share/man --infodir=/usr/sgug/share/info --sysconfdir=/usr/sgug/etc --host=mips-sgi-irix6.5 --build=x86_64-linux-gnu $common_configure_opts \'
  - pattern: --with-ssl --with-ca-bundle
    replacement: --with-openssl=/opt/sgug-staging/usr/sgug --with-ca-bundle
  - pattern: --with-gssapi
    replacement: --without-gssapi
  - pattern: --with-libidn2
    replacement: --without-libidn2
  - pattern: --with-nghttp2
    replacement: --without-nghttp2
  - pattern: --with-brotli
    replacement: --without-brotli
