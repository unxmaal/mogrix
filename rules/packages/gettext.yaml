package: gettext
rules:
  drop_subpackages:
  - common-devel
  - libtextstyle
  - libtextstyle-devel
  ac_cv_overrides:
    ac_cv_func_stpcpy: 'yes'
    ac_cv_func_getdelim: 'yes'
    ac_cv_have_decl_getdelim: 'yes'
    gl_cv_onwards_func_getdelim: 'yes'
    ac_cv_func_getline: 'yes'
    ac_cv_have_decl_getline: 'yes'
    gl_cv_onwards_func_getline: 'yes'
  spec_replacements:
  - pattern: '%files -f %{name}-tools.lang'
    replacement: '%files'
  - pattern: '%files runtime -f %{name}-runtime.lang'
    replacement: '%files runtime'
  - pattern: "%configure --enable-nls --disable-static \\\n    --enable-shared --disable-csharp --disable-rpath \\\n%if %{with java}\n    --enable-java \\\n%else\n    --disable-java --disable-native-java\
      \ \\\n%endif\n    --with-xz"
    replacement: "%configure --enable-nls --disable-static \\\n    --enable-shared --disable-csharp --disable-rpath \\\n    --disable-java --disable-native-java \\\n    --disable-libasprintf --disable-openmp\
      \ \\\n    --without-emacs --without-git --without-cvs --without-bzip2 \\\n    --with-included-libxml --with-included-libunistring \\\n    --with-xz"
  - pattern: export CPPFLAGS="-I%{_includedir}/libxml2"
    replacement: '# glib2 disabled (circular dep)

      export CPPFLAGS="$CPPFLAGS"'
  - pattern: export LIBS="-lxml2"
    replacement: '# bundled libxml2 used

      export LIBS="$LIBS"'
  - pattern: 'Requires: %{name}-common-devel = %{version}-%{release}

      '
    replacement: ''
  - pattern: install -d ${RPM_BUILD_ROOT}%{_emacs_sitestartdir}
    replacement: '# emacs disabled'
  - pattern: mv ${RPM_BUILD_ROOT}%{_emacs_sitelispdir}/%{name}/start-po.el ${RPM_BUILD_ROOT}%{_emacs_sitestartdir}
    replacement: '# emacs disabled'
  - pattern: rm ${RPM_BUILD_ROOT}%{_emacs_sitelispdir}/%{name}/start-po.elc
    replacement: '# emacs disabled'
  - pattern: install -pm 755 %SOURCE2 ${RPM_BUILD_ROOT}%{_bindir}/msghack
    replacement: '# msghack disabled'
  - pattern: install -pm 644 %SOURCE3 ${RPM_BUILD_ROOT}%{_mandir}/man1/msghack.1
    replacement: '# msghack disabled'
  - pattern: chmod 755 ${RPM_BUILD_ROOT}%{_libdir}/preloadable_libintl.so
    replacement: '# preloadable_libintl disabled for IRIX'
  - pattern: '%{_libdir}/preloadable_libintl.so'
    replacement: ''
  - pattern: '%{_libdir}/libasprintf.so.0*'
    replacement: ''
  - pattern: '%{_libdir}/libasprintf.so'
    replacement: ''
  - pattern: '%{_includedir}/autosprintf.h'
    replacement: '# autosprintf disabled (C++)'
  - pattern: '%{_infodir}/autosprintf*'
    replacement: ''
  - pattern: rm ${RPM_BUILD_ROOT}%{_libdir}/libgettext{src,lib}.so
    replacement: rm -f ${RPM_BUILD_ROOT}%{_libdir}/libgettextsrc.so ${RPM_BUILD_ROOT}%{_libdir}/libgettextlib.so
  - pattern: rm ${RPM_BUILD_ROOT}%{_libdir}/lib*.la
    replacement: rm -f ${RPM_BUILD_ROOT}%{_libdir}/lib*.la
  - pattern: rm -r ${RPM_BUILD_ROOT}%{_datadir}/doc/gettext/javadoc*
    replacement: rm -rf ${RPM_BUILD_ROOT}%{_datadir}/doc/gettext/javadoc* 2>/dev/null || true
  - pattern: mv ${RPM_BUILD_ROOT}%{_datadir}/doc/gettext/* ${RPM_BUILD_ROOT}%{_datadir}/doc/libasprintf/* htmldoc
    replacement: mv ${RPM_BUILD_ROOT}%{_datadir}/doc/gettext/* htmldoc 2>/dev/null || true
  - pattern: rm -r ${RPM_BUILD_ROOT}%{_datadir}/doc/libasprintf
    replacement: rm -rf ${RPM_BUILD_ROOT}%{_datadir}/doc/libasprintf 2>/dev/null || true
  - pattern: '%dir %{_emacs_sitelispdir}/%{name}'
    replacement: ''
  - pattern: '%{_emacs_sitelispdir}/%{name}/*.elc'
    replacement: ''
  - pattern: '%{_emacs_sitelispdir}/%{name}/*.el'
    replacement: ''
  - pattern: '%{_emacs_sitestartdir}/*.el'
    replacement: ''
  - pattern: '%{_includedir}/gettext-po.h'
    replacement: '%{_includedir}/gettext-po.h

      %{_includedir}/libintl.h

      %{_libdir}/libintl.so'
  - pattern: '%{_libdir}/libgettextlib-0.*.so'
    replacement: '%{_libdir}/libintl.so.8*

      %{_libdir}/libgettextlib-0.*.so'
  - pattern: '%{_datadir}/%{name}/config.rpath'
    replacement: '%{_datadir}/%{name}/config.rpath

      %{_datadir}/%{name}/archive.*.tar.xz'
  - pattern: '%{_bindir}/gettext.sh'
    replacement: '%{_bindir}/gettext.sh

      %{_datadir}/locale/locale.alias'
  - pattern: '%{_bindir}/msghack'
    replacement: ''
  - pattern: '%{_mandir}/man1/msghack.1*'
    replacement: ''
  - pattern: autoreconf
    replacement: '# autoreconf disabled for cross-compilation â€” use shipped configure'
  - pattern: '%{_datadir}/locale/locale.alias'
    replacement: ''
  - pattern: "sed -e 's|^hardcode_libdir_flag_spec=.*|hardcode_libdir_flag_spec=\"\"|g' \\\n    -e 's|^runpath_var=LD_RUN_PATH|runpath_var=DIE_RPATH_DIE|g' \\\n    -e 's|CC=.g..|& -Wl,--as-needed|' \\\n\
      \    -i $(find . -name libtool)"
    replacement: '# rpath elimination handled by mogrix'
