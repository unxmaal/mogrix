package: libevent
rules:
  prep_commands:
  - $MOGRIX_ROOT/tools/safepatch Makefile.am --delete-line 'include test/include.am' --no-backup --quiet
  inject_compat_functions:
  - strsep
  ac_cv_overrides:
    ac_cv_func_setenv: 'yes'
    ac_cv_func_unsetenv: 'yes'
    ac_cv_func_strsep: 'yes'
  spec_replacements:
  - pattern: "%if ! 0%{?_module_build}\n    --enable-doxygen-doc \\\n%endif\n"
    replacement: ''
  - pattern: '%make_build all'
    replacement: '%make_build'
  - pattern: mv $RPM_BUILD_ROOT/%{_docdir}/%{name} $RPM_BUILD_ROOT/%{develdocdir}
    replacement: mkdir -p $RPM_BUILD_ROOT/%{develdocdir}
  - pattern: "# Fix multilib install of devel (bug #477685)\nmv $RPM_BUILD_ROOT%{_includedir}/event2/event-config.h \\\n   $RPM_BUILD_ROOT%{_includedir}/event2/event-config-%{__isa_bits}.h\ncat > $RPM_BUILD_ROOT%{_includedir}/event2/event-config.h\
      \ << EOF\n#include <bits/wordsize.h>\n\n#if __WORDSIZE == 32\n#include <event2/event-config-32.h>\n#elif __WORDSIZE == 64\n#include <event2/event-config-64.h>\n#else\n#error \"Unknown word size\"\n\
      #endif\nEOF"
    replacement: '# Multilib event-config.h fixup skipped â€” single-arch cross-build (n32)'
  - pattern: -2.1.so.*
    replacement: -2.1.so*
  - pattern: "%{__python3} %{_rpmconfigdir}/redhat/pathfix.py -i %{__python3} -pn test/check-dumpevents.py \\\n                               event_rpcgen.py"
    replacement: '# pathfix.py removed for cross-build'
