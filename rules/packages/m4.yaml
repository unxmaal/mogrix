# m4 package rules for IRIX cross-compilation
package: m4

smoke_test:
  - command: "/usr/sgug/bin/m4 --version"
    expect: "1.4.19"
  - command: "echo 'define(FOO,bar)FOO' | /usr/sgug/bin/m4"
    expect: "bar"

# m4 1.4.19 gnulib already has IRIX getprogname support (was missing in 1.4.18)
# Old m4.sgifixes.patch no longer needed

rules:
  export_vars:
    CFLAGS: "%{optflags} -DWCHAR_MAX=0x7fffffff"
  # IRIX wchar.h hides C99/XPG5 functions behind _WCHAR_CORE_EXTENSIONS_1
  # (requires __c99 or _XOPEN_SOURCE>=500, neither set with clang).
  # Tell configure they're missing so gnulib provides its own replacements.
  ac_cv_overrides:
    ac_cv_func_mbsinit: "no"
    gl_cv_func_mbsinit_works: "no"
    ac_cv_func_wcrtomb: "no"
    # IRIX select() works fine - prevent gnulib from replacing it.
    # Cross-compile default "guessing no" is wrong for IRIX.
    # generic.yaml sets ac_cv_header_sys_random_h=no, so gnulib won't see
    # our compat getrandom. Let gnulib provide its own replacement.
    ac_cv_func_getrandom: "no"
    # IRIX has sigprocmask â€” tell gnulib so it doesn't provide its own
    # replacement which has a hardcoded NSIG<=32 constraint (IRIX has NSIG=65)
    ac_cv_func_sigprocmask: "yes"
    ac_cv_func_sigaction: "yes"
    ac_cv_member_struct_sigaction_sa_sigaction: "yes"


