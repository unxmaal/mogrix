--- a/client/gpgcheck.c
+++ b/client/gpgcheck.c
@@ -145,6 +145,12 @@ error:
     goto cleanup;
 }

+/*
+ * rpm 4.19 API port:
+ * - pgpDig removed, use rpmKeyringAddKey directly
+ * - rpmPubkeyDig() and rpmKeyringLookup() removed
+ * - rpmKeyringAddKey returns: 0=added, 1=already present, -1=error
+ */
 uint32_t
 AddKeyPktToKeyring(
     rpmKeyring pKeyring,
@@ -153,7 +159,7 @@ AddKeyPktToKeyring(
     )
 {
     uint32_t dwError = 0;
-    pgpDig pDig = NULL;
+    int rc;
     rpmPubkey pPubkey = NULL;

     if(!pKeyring || !pPkt || nPktLen == 0)
@@ -162,33 +168,21 @@ AddKeyPktToKeyring(
         BAIL_ON_TDNF_ERROR(dwError);
     }

-    pPubkey = rpmPubkeyNew (pPkt, nPktLen);
+    pPubkey = rpmPubkeyNew(pPkt, nPktLen);
     if(!pPubkey)
     {
         dwError = ERROR_TDNF_CREATE_PUBKEY_FAILED;
         BAIL_ON_TDNF_ERROR(dwError);
     }

-    pDig = rpmPubkeyDig(pPubkey);
-    if(!pDig)
+    /* rpm 4.19: Just add the key directly */
+    rc = rpmKeyringAddKey(pKeyring, pPubkey);
+    if(rc < 0)
     {
         dwError = ERROR_TDNF_CREATE_PUBKEY_FAILED;
         BAIL_ON_TDNF_ERROR(dwError);
     }
-
-    dwError = rpmKeyringLookup(pKeyring, pDig);
-    if(dwError == RPMRC_OK)
-    {
-        dwError = 0;//key exists
-    }
-    else
-    {
-        dwError = rpmKeyringAddKey(pKeyring, pPubkey);
-        if(dwError == 1)
-        {
-            dwError = 0;//Already added. ignore
-        }
-        BAIL_ON_TDNF_ERROR(dwError);
-    }
+    /* rc == 0 or rc == 1 both mean success */
+    dwError = 0;
+
 cleanup:
     return dwError;
 error:
@@ -199,6 +193,14 @@ error:
     goto cleanup;
 }

+/*
+ * rpm 4.19 API port:
+ * - pgpDig removed, use pgpDigParams
+ * - pgpNewDig() removed, use pgpPrtParams() directly
+ * - pgpPrtPkts() removed, use pgpPrtParams()
+ * - pgpFreeDig() renamed to pgpDigParamsFree()
+ * - rpmKeyringLookup() replaced with rpmKeyringVerifySig()
+ */
 uint32_t
 VerifyRpmSig(
     rpmKeyring pKeyring,
@@ -210,7 +212,8 @@ VerifyRpmSig(
     rpmts pTS = NULL;
     rpmtd pTD = NULL;
     Header pPkgHeader = NULL;
-    pgpDig pDigest = NULL;
+    pgpDigParams pDigest = NULL;
+    rpmRC rc;

     if(!pKeyring || IsNullOrEmptyString(pszPkgFile))
     {
@@ -254,18 +257,22 @@ VerifyRpmSig(
         BAIL_ON_TDNF_ERROR(dwError);
     }

-    pDigest = pgpNewDig();
-    if(pgpPrtPkts(pTD->data, pTD->count, pDigest, 0))
+    /* rpm 4.19: use pgpPrtParams instead of pgpNewDig + pgpPrtPkts */
+    if(pgpPrtParams(pTD->data, pTD->count, PGPTAG_SIGNATURE, &pDigest))
     {
         dwError = ERROR_TDNF_RPM_GPG_PARSE_FAILED;
         BAIL_ON_TDNF_ERROR(dwError);
     }

-    if(rpmKeyringLookup(pKeyring, pDigest) != RPMRC_OK)
+    /* rpm 4.19: rpmKeyringVerifySig replaces rpmKeyringLookup
+     * Pass NULL for DIGEST_CTX - checking if key is present.
+     * Returns RPMRC_NOKEY if the signing key is not in keyring. */
+    rc = rpmKeyringVerifySig(pKeyring, pDigest, NULL);
+    if(rc == RPMRC_NOKEY)
     {
         dwError = ERROR_TDNF_RPM_GPG_NO_MATCH;
         BAIL_ON_TDNF_ERROR(dwError);
     }

 cleanup:
     if(pFD_t)
@@ -274,7 +281,7 @@ cleanup:
     }
     if(pDigest)
     {
-        pgpFreeDig(pDigest);
+        pgpDigParamsFree(pDigest);
     }
     if(pPkgHeader)
     {
