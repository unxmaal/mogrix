# libsolv - Package dependency solver
# Has sgifixes patches, needs compat functions

package: libsolv

rules:
  # Compat functions needed
  inject_compat_functions:
    - strdup
    - strndup
    - getline

  # Drop libdicl dependency
  drop_buildrequires:
    - libdicl-devel
    - libdicl

  drop_requires:
    - libdicl
    - libdicl-devel

  # Autoconf cache overrides (libsolv uses cmake)
  ac_cv_overrides:
    ac_cv_func_malloc_0_nonnull: "yes"
    ac_cv_func_realloc_0_nonnull: "yes"

  # libsolv uses CMake, these are cmake options
  # -DENABLE_RPMDB=ON
  # -DENABLE_RPMMD=ON
  # -DENABLE_RPMPKG=ON
  # -DENABLE_COMPS=ON
  # -DWITH_LIBXML2=ON
  # -DENABLE_COMPLEX_DEPS=ON

  # Remove libdicl setup lines
  remove_lines:
    - 'export CPPFLAGS="-I%{_includedir}/libdicl-0.1"'
    - 'export LIBS="-ldicl-0.1"'
