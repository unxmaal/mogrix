# libtasn1 - ASN.1 parsing library
# Has sgifixes patches, needs compat functions

package: libtasn1

# IRIX-specific patches from SGUG-RSE
add_patch:
  - libtasn1.sgifixes.patch

rules:
  # Compat functions needed

  # NOTE: libdicl drop_buildrequires/drop_requires handled by generic.yaml

  # Autoconf cache overrides
  # NOTE: ac_cv_func_malloc/realloc_0_nonnull handled by generic.yaml
  ac_cv_overrides:
    gl_cv_func_working_getdelim: "yes"

  configure_flags:
    add:
      - --disable-doc
      - --disable-gtk-doc
      - --disable-gcc-warnings

  # Remove GPG signature verification (gpgv2 not available during cross-compilation)
  remove_lines:
    - "gpgv2"

  spec_replacements:
    # Skip gtkdocize during autoreconf (not available for cross-compilation)
    - pattern: "autoreconf -v -f --install"
      replacement: "GTKDOCIZE=true autoreconf -v -f --install"
    # No man pages or info files installed (docs disabled)
    - pattern: "%{_mandir}/man1/asn1*"
      replacement: ""
    - pattern: "%{_mandir}/man3/*asn1*"
      replacement: ""
    - pattern: "%{_infodir}/*.info.*"
      replacement: ""
    # Fix bash-ism brace expansion in original cleanup
    - pattern: "rm -f $RPM_BUILD_ROOT{%_libdir/*.la,%_infodir/dir}"
      replacement: "rm -f $RPM_BUILD_ROOT%{_libdir}/*.la $RPM_BUILD_ROOT%{_infodir}/dir"

