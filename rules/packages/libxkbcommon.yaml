package: libxkbcommon
rules:
  prep_commands:
  - "perl -0777 -pi -e 's/^test\\(.*?(?=^# Documentation)//ms' meson.build"
  drop_buildrequires:
  - byacc
  - xorg-x11-proto-devel
  - libX11-devel
  - xkeyboard-config-devel
  spec_replacements:
  - pattern: "%meson -Denable-docs=false \\\n       -Denable-x11=true \\\n       -Denable-wayland=false\n%meson_build"
    replacement: "MOGRIX_CROSS=/home/edodd/projects/github/unxmaal/mogrix/cross/meson-irix-cross.ini\n/home/edodd/.local/bin/meson setup _build \\\n  --cross-file=$MOGRIX_CROSS \\\n  --prefix=%{_prefix}\
      \ \\\n  --libdir=%{_libdir} \\\n  -Denable-docs=false \\\n  -Denable-x11=true \\\n  -Denable-wayland=false \\\n  -Denable-tools=false \\\n  -Denable-bash-completion=false \\\n  -Dc_link_args=\"-L$COMPAT_DIR\
      \ -lmogrix-compat\" \\\n  --wrap-mode=nodownload\n/home/edodd/.local/bin/meson compile -C _build\n"
  - pattern: '%meson_install'
    replacement: DESTDIR=$RPM_BUILD_ROOT /home/edodd/.local/bin/meson install -C _build --no-rebuild
  - pattern: 'URL:            http://www.x.org'
    replacement: 'URL:            http://www.x.org

      Provides: libxkbcommon.so.0(mips-32)

      Provides: libxkbregistry.so.0(mips-32)

      Provides: libxkbcommon-x11.so.0(mips-32)

      Provides: libxkbcommon(mips-32) = %{version}-%{release}

      '
  - pattern: 'Requires:       %{name}%{?_isa} = %{version}-%{release}'
    replacement: 'Requires:       %{name} = %{version}-%{release}'
    replace_all: true
  - pattern: 'Requires:       %{name}-x11%{?_isa} = %{version}-%{release}'
    replacement: 'Requires:       %{name}-x11 = %{version}-%{release}'
  - pattern: '%ldconfig_scriptlets'
    replacement: '# ldconfig removed'
    replace_all: true
  - pattern: '%package utils

      Summary:        X.Org X11 XKB parsing utilities

      Requires:       %{name} = %{version}-%{release}


      %description utils

      %{name}-utils is a set of utilities to analyze and test XKB parsing.'
    replacement: '# utils subpackage removed (MIPS binaries)'
  - pattern: '%files utils

      %{_bindir}/xkbcli

      %{_libexecdir}/xkbcommon/xkbcli-compile-keymap

      %{_libexecdir}/xkbcommon/xkbcli-how-to-type

      %{_libexecdir}/xkbcommon/xkbcli-interactive-evdev

      %{_libexecdir}/xkbcommon/xkbcli-interactive-x11

      %{_libexecdir}/xkbcommon/xkbcli-list

      %{_mandir}/man1/xkbcli-compile-keymap.1.gz

      %{_mandir}/man1/xkbcli-how-to-type.1.gz

      %{_mandir}/man1/xkbcli-interactive-evdev.1.gz

      %{_mandir}/man1/xkbcli-interactive-x11.1.gz

      %{_mandir}/man1/xkbcli-list.1.gz

      %{_mandir}/man1/xkbcli.1.gz

      %{_datadir}/bash-completion/completions/xkbcli'
    replacement: '# utils files removed'
  - pattern: '%files x11

      %{_libdir}/libxkbcommon-x11.so.0.0.0

      %{_libdir}/libxkbcommon-x11.so.0'
    replacement: '# x11 files merged into main'
  - pattern: '%files x11-devel

      %{_libdir}/libxkbcommon-x11.so

      %{_includedir}/xkbcommon/xkbcommon-x11.h

      %{_libdir}/pkgconfig/xkbcommon-x11.pc'
    replacement: '# x11-devel merged into devel'
  - pattern: '%{_libdir}/libxkbregistry.so.0.0.0

      %{_libdir}/libxkbregistry.so.0'
    replacement: '%{_libdir}/libxkbregistry.so.0.0.0

      %{_libdir}/libxkbregistry.so.0

      %{_libdir}/libxkbcommon-x11.so.0.0.0

      %{_libdir}/libxkbcommon-x11.so.0'
  - pattern: '%{_libdir}/pkgconfig/xkbcommon.pc

      %{_libdir}/pkgconfig/xkbregistry.pc'
    replacement: '%{_libdir}/pkgconfig/xkbcommon.pc

      %{_libdir}/pkgconfig/xkbregistry.pc

      %{_libdir}/libxkbcommon-x11.so

      %{_includedir}/xkbcommon/xkbcommon-x11.h

      %{_libdir}/pkgconfig/xkbcommon-x11.pc'
  install_cleanup:
  - rm -f %{buildroot}%{_bindir}/xkbcli || true
  - rm -rf %{buildroot}%{_libexecdir}/xkbcommon || true
  - rm -rf %{buildroot}%{_mandir}/man1/xkbcli* || true
  - rm -rf %{buildroot}%{_datadir}/bash-completion || true
