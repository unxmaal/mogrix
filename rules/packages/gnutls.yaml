# gnutls - TLS library
# Needs compat functions

package: gnutls

rules:
  # Compat functions needed
  inject_compat_functions:
    - strdup
    - strndup
    - asprintf
    - vasprintf
    - getline

  # NOTE: libdicl drop_buildrequires/drop_requires handled by generic.yaml
  drop_buildrequires:
    - trousers-devel
    - libidn2-devel

  # Autoconf cache overrides
  # NOTE: ac_cv_func_malloc/realloc_0_nonnull handled by generic.yaml
  ac_cv_overrides:
    gl_cv_func_working_getdelim: "yes"

  # Configure flags
  configure_flags:
    add:
      - --disable-doc
      - --disable-gtk-doc
      - --disable-guile
      - --disable-dane
      - --disable-hardware-acceleration
      - --without-tpm
      - --without-tpm2
      - --without-idn
      - --disable-libdane
      - --disable-valgrind-tests
    remove:
      - --enable-ktls
      - --with-default-trust-store-pkcs11

  # Disable Linux-specific features
  configure_disable:
    - seccomp-tests

  # NOTE: libdicl remove_lines handled by generic.yaml
